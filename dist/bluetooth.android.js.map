{"version":3,"sources":["bluetooth.android.ts"],"names":[],"mappings":"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","file":"bluetooth.android.js","sourcesContent":["///<reference path=\"_references.d.ts\" />\"\r\n\r\nimport * as utils from \"utils/utils\"\r\nimport * as application from \"application\";\r\nimport {common} from \"./bluetooth-common\";\r\n\r\nmodule Bluetooth {\r\n  var ACCESS_COARSE_LOCATION_PERMISSION_REQUEST_CODE = 222;\r\n  var common = new common;\r\n  var adapter,onDiscovered;\r\n\r\n  function _coarseLocationPermissionGranted () {\r\n    var hasPermission = android.os.Build.VERSION.SDK_INT < 23; // Android M. (6.0)\r\n    if (!hasPermission) {\r\n      hasPermission = android.content.pm.PackageManager.PERMISSION_GRANTED ==\r\n        android.support.v4.content.ContextCompat.checkSelfPermission(application.android.foregroundActivity, android.Manifest.permission.ACCESS_COARSE_LOCATION);\r\n    }\r\n    return hasPermission;\r\n  };\r\n\r\n  function hasCoarseLocationPermission() {\r\n    return new Promise(function (resolve) {\r\n      resolve(_coarseLocationPermissionGranted());\r\n    });\r\n  };\r\n\r\n  function requestCoarseLocationPermission() {\r\n    return new Promise(function (resolve) {\r\n      if (!_coarseLocationPermissionGranted()) {\r\n        // in a future version we could hook up the callback and change this flow a bit\r\n        android.support.v4.app.ActivityCompat.requestPermissions(\r\n          application.android.foregroundActivity,\r\n          [android.Manifest.permission.ACCESS_COARSE_LOCATION],\r\n          ACCESS_COARSE_LOCATION_PERMISSION_REQUEST_CODE);\r\n        // this is not the nicest solution as the user needs to initiate scanning again after granting permission,\r\n        // so enhance this in a future version, but it's ok for now\r\n        resolve();\r\n      }\r\n    });\r\n  };\r\n\r\n  /**\r\n   * Connections are stored as key-val pairs of UUID-Connection.\r\n   * So something like this:\r\n   * [{\r\n   *   34343-2434-5454: {\r\n   *     state: 'connected',\r\n   *     discoveredState: '',\r\n   *     operationConnect: someCallbackFunction\r\n   *   },\r\n   *   1323213-21321323: {\r\n   *     ..\r\n   *   }\r\n   * }, ..]\r\n   */\r\n  var _connections = {};\r\n  var _scanCallback;\r\n  (function () {\r\n    var bluetoothManager = utils.ad.getApplicationContext().getSystemService(android.content.Context.BLUETOOTH_SERVICE);\r\n    adapter = bluetoothManager.getAdapter();\r\n\r\n    if (android.os.Build.VERSION.SDK_INT >= 21 /*android.os.Build.VERSION_CODES.LOLLIPOP */) {\r\n      var MyScanCallback = android.bluetooth.le.ScanCallback.extend({\r\n        onBatchScanResults: function (results) {\r\n          console.log(\"------- scanCallback.onBatchScanResults\");\r\n        },\r\n        onScanFailed: function (errorCode) {\r\n          console.log(\"------- scanCallback.onScanFailed errorCode: \" + errorCode);\r\n          var errorMessage;\r\n          if (errorCode == android.bluetooth.le.ScanCallback.SCAN_FAILED_ALREADY_STARTED) {\r\n            errorMessage = \"Scan already started\";\r\n          } else if (errorCode == android.bluetooth.le.ScanCallback.SCAN_FAILED_APPLICATION_REGISTRATION_FAILED) {\r\n            errorMessage = \"Application registration failed\";\r\n          } else if (errorCode == android.bluetooth.le.ScanCallback.SCAN_FAILED_FEATURE_UNSUPPORTED) {\r\n            errorMessage = \"Feature unsupported\";\r\n          } else if (errorCode == android.bluetooth.le.ScanCallback.SCAN_FAILED_INTERNAL_ERROR) {\r\n            errorMessage = \"Internal error\";\r\n          } else {\r\n            errorMessage = \"Scan failed to start\";\r\n          }\r\n          console.log(\"------- scanCallback.onScanFailed errorMessage: \" + errorMessage);\r\n        },\r\n        onScanResult: function (callbackType, result) {\r\n          var stateObject = _connections[result.getDevice().getAddress()];\r\n          if (!stateObject) {\r\n            _connections[result.getDevice().getAddress()] = {\r\n              state: 'disconnected'\r\n            };\r\n            var payload = {\r\n              type: 'scanResult', // TODO or use different callback functions?\r\n              UUID: result.getDevice().getAddress(),\r\n              name: result.getDevice().getName(),\r\n              RSSI: result.getRssi(),\r\n              state: 'disconnected',\r\n              advertisement: android.util.Base64.encodeToString(result.getScanRecord().getBytes(), android.util.Base64.NO_WRAP)\r\n            };\r\n            console.log(\"---- Lollipop+ scanCallback result: \" + JSON.stringify(payload));\r\n            onDiscovered(payload);\r\n          }\r\n        }\r\n      });\r\n      var _scanCallback = new MyScanCallback();\r\n    } else {\r\n      _scanCallback = new android.bluetooth.BluetoothAdapter.LeScanCallback({\r\n        // see https://github.com/randdusing/cordova-plugin-bluetoothle/blob/master/src/android/BluetoothLePlugin.java#L2181\r\n        onLeScan: function (device, rssi, scanRecord) {\r\n          var stateObject = _connections[device.getAddress()];\r\n          if (!stateObject) {\r\n            _connections[device.getAddress()] = {\r\n              state: 'disconnected'\r\n            };\r\n            onDiscovered({\r\n              type: 'scanResult', // TODO or use different callback functions?\r\n              UUID: device.getAddress(), // TODO consider renaming to id (and iOS as well)\r\n              name: device.getName(),\r\n              RSSI: rssi,\r\n              state: 'disconnected'\r\n            });\r\n          }\r\n        }\r\n      });\r\n    }\r\n  })();\r\n\r\n  // callback for connecting and read/write operations\r\n  var _MyGattCallback = android.bluetooth.BluetoothGattCallback.extend({\r\n    // add constructor which gets a callback\r\n\r\n    /**\r\n     * newState (BluetoothProfile.state)\r\n     * 0: disconnected\r\n     * 1: connecting\r\n     * 2: connected\r\n     * 3: disconnecting\r\n     */\r\n    onConnectionStateChange: function (bluetoothGatt, status, newState) {\r\n      console.log(\"------- _MyGattCallback.onConnectionStateChange, status: \" + status + \", new state: \" + newState);\r\n\r\n      // https://github.com/don/cordova-plugin-ble-central/blob/master/src/android/Peripheral.java#L191    \r\n      if (newState == 2 /* connected */ && status === 0 /* gatt success */) {\r\n        console.log(\"---- discovering services..\");\r\n        bluetoothGatt.discoverServices();\r\n      } else {\r\n        // perhaps the device was manually disconnected, or in use by another device\r\n        _disconnect(bluetoothGatt);\r\n      }\r\n    },\r\n\r\n    onServicesDiscovered: function (bluetoothGatt, status) {\r\n      console.log(\"------- _MyGattCallback.onServicesDiscovered, status (0=success): \" + status);\r\n\r\n      if (status === 0 /* gatt success */) {\r\n        // TODO grab from cached object and extend with services data?\r\n        var services = bluetoothGatt.getServices();\r\n        var servicesJs = [];\r\n        var btChar = android.bluetooth.BluetoothGattCharacteristic;\r\n        for (var i = 0; i < services.size(); i++) {\r\n          var service = services.get(i);\r\n          var characteristics = service.getCharacteristics();\r\n          var characteristicsJs = [];\r\n          for (var j = 0; j < characteristics.size(); j++) {\r\n            var characteristic = characteristics.get(j);\r\n            var props = characteristic.getProperties();\r\n            var descriptors = characteristic.getDescriptors();\r\n            var descriptorsJs = [];\r\n            for (var k = 0; k < descriptors.size(); k++) {\r\n              var descriptor = descriptors.get(k);\r\n\r\n              var descPerms = descriptor.getPermissions();\r\n              if (descPerms > 0) {\r\n                var _permissions = {\r\n                  read: (descPerms & btChar.PERMISSION_READ) !== 0,\r\n                  readEncrypted: (descPerms & btChar.PERMISSION_READ_ENCRYPTED) !== 0,\r\n                  readEncryptedMitm: (descPerms & btChar.PERMISSION_READ_ENCRYPTED_MITM) !== 0,\r\n                  write: (descPerms & btChar.PERMISSION_WRITE) !== 0,\r\n                  writeEncrypted: (descPerms & btChar.PERMISSION_WRITE_ENCRYPTED) !== 0,\r\n                  writeEncryptedMitm: (descPerms & btChar.PERMISSION_WRITE_ENCRYPTED_MITM) !== 0,\r\n                  writeSigned: (descPerms & btChar.PERMISSION_WRITE_SIGNED) !== 0,\r\n                  writeSignedMitm: (descPerms & btChar.PERMISSION_WRITE_SIGNED_MITM) !== 0\r\n                };\r\n                var descriptorJs = {\r\n                  UUID: _uuidToString(descriptor.getUuid()),\r\n                  value: descriptor.getValue(), // always empty btw\r\n                  permissions: _permissions\r\n                };\r\n              }\r\n              descriptorsJs.push(descriptorJs);\r\n            }\r\n            // permissions are usually not provided, so let's not return them in that case\r\n            var charPerms = characteristic.getPermissions();\r\n            if (charPerms > 0) {\r\n              var _permissions = {\r\n                read: (charPerms & btChar.PERMISSION_READ) !== 0,\r\n                readEncrypted: (charPerms & btChar.PERMISSION_READ_ENCRYPTED) !== 0,\r\n                readEncryptedMitm: (charPerms & btChar.PERMISSION_READ_ENCRYPTED_MITM) !== 0,\r\n                write: (charPerms & btChar.PERMISSION_WRITE) !== 0,\r\n                writeEncrypted: (charPerms & btChar.PERMISSION_WRITE_ENCRYPTED) !== 0,\r\n                writeEncryptedMitm: (charPerms & btChar.PERMISSION_WRITE_ENCRYPTED_MITM) !== 0,\r\n                writeSigned: (charPerms & btChar.PERMISSION_WRITE_SIGNED) !== 0,\r\n                writeSignedMitm: (charPerms & btChar.PERMISSION_WRITE_SIGNED_MITM) !== 0\r\n              };\r\n            }\r\n            var characteristicJs = {\r\n              UUID: _uuidToString(characteristic.getUuid()),\r\n              name: _uuidToString(characteristic.getUuid()), // there's no sep field on Android\r\n              properties: {\r\n                read: (props & btChar.PROPERTY_READ) !== 0,\r\n                write: (props & btChar.PROPERTY_WRITE) !== 0,\r\n                writeWithoutResponse: (props & btChar.PROPERTY_WRITE_NO_RESPONSE) !== 0,\r\n                notify: (props & btChar.PROPERTY_NOTIFY) !== 0,\r\n                indicate: (props & btChar.PROPERTY_INDICATE) !== 0,\r\n                broadcast: (props & btChar.PROPERTY_BROADCAST) !== 0,\r\n                authenticatedSignedWrites: (props & btChar.PROPERTY_SIGNED_WRITE) !== 0,\r\n                extendedProperties: (props & btChar.PROPERTY_EXTENDED_PROPS) !== 0\r\n              },\r\n              descriptors: descriptorsJs,\r\n              permissions: _permissions\r\n            };\r\n            characteristicsJs.push(characteristicJs);\r\n          }\r\n\r\n          servicesJs.push({\r\n            UUID: _uuidToString(service.getUuid()),\r\n            characteristics: characteristicsJs\r\n          });\r\n        }\r\n        var device = bluetoothGatt.getDevice();\r\n        var stateObject = _connections[device.getAddress()];\r\n        stateObject.onConnected({\r\n          UUID: device.getAddress(), // TODO consider renaming to id (and iOS as well)\r\n          name: device.getName(),\r\n          state: 'connected', // Bluetooth._getState(peripheral.state),\r\n          services: servicesJs\r\n        });\r\n      }\r\n    },\r\n\r\n    _decodeValue: function (value) {\r\n      if (value === null) {\r\n        return null;\r\n      }\r\n\r\n      // value is of Java type: byte[]\r\n      var b = android.util.Base64.encodeToString(value, android.util.Base64.NO_WRAP);\r\n      return common._base64ToArrayBuffer(b);\r\n    },\r\n\r\n    onCharacteristicRead: function (bluetoothGatt, bluetoothGattCharacteristic, status) {\r\n      console.log(\"------- _MyGattCallback.onCharacteristicRead\");\r\n\r\n      var device = bluetoothGatt.getDevice();\r\n      var stateObject = _connections[device.getAddress()];\r\n      if (!stateObject) {\r\n        _disconnect(bluetoothGatt);\r\n        return;\r\n      }\r\n\r\n      if (stateObject.onReadPromise) {\r\n        var value = bluetoothGattCharacteristic.getValue();\r\n        stateObject.onReadPromise({\r\n          valueRaw: value,\r\n          value: this._decodeValue(value),\r\n          characteristicUUID: bluetoothGattCharacteristic.getUuid()\r\n        });\r\n      }\r\n    },\r\n\r\n    onCharacteristicChanged: function (bluetoothGatt, bluetoothGattCharacteristic) {\r\n      console.log(\"------- _MyGattCallback.onCharacteristicChanged\");\r\n\r\n      var device = bluetoothGatt.getDevice();\r\n      var stateObject = _connections[device.getAddress()];\r\n      if (!stateObject) {\r\n        _disconnect(bluetoothGatt);\r\n        return;\r\n      }\r\n\r\n      if (stateObject.onNotifyCallback) {\r\n        var value = bluetoothGattCharacteristic.getValue();\r\n        stateObject.onNotifyCallback({\r\n          valueRaw: value,\r\n          value: this._decodeValue(value),\r\n          characteristicUUID: bluetoothGattCharacteristic.getUuid()\r\n        });\r\n      }\r\n    },\r\n\r\n    onCharacteristicWrite: function (bluetoothGatt, bluetoothGattCharacteristic, status) {\r\n      console.log(\"------- _MyGattCallback.onCharacteristicWrite\");\r\n\r\n      var device = bluetoothGatt.getDevice();\r\n      var stateObject = _connections[device.getAddress()];\r\n      if (!stateObject) {\r\n        _disconnect(bluetoothGatt);\r\n        return;\r\n      }\r\n\r\n      console.log(bluetoothGattCharacteristic);\r\n\r\n      if (stateObject.onWritePromise) {\r\n        stateObject.onWritePromise({\r\n          characteristicUUID: bluetoothGattCharacteristic.getUuid()\r\n        });\r\n      }\r\n    },\r\n\r\n    onDescriptorRead: function (bluetoothGatt, bluetoothGattDescriptor, status) {\r\n      console.log(\"------- _MyGattCallback.onDescriptorRead\");\r\n    },\r\n\r\n    onDescriptorWrite: function (bluetoothGatt, bluetoothGattDescriptor, status) {\r\n      console.log(\"------- _MyGattCallback.onDescriptorWrite\");\r\n    },\r\n\r\n    onReadRemoteRssi: function (bluetoothGatt, rssi, status) {\r\n      console.log(\"------- _MyGattCallback.onReadRemoteRssi\");\r\n    },\r\n\r\n    onMtuChanged: function (bluetoothGatt, mtu, status) {\r\n      console.log(\"------- _MyGattCallback.onMtuChanged\");\r\n    }\r\n  });\r\n\r\n  function _isEnabled (arg?) {\r\n    return adapter !== null && adapter.isEnabled();\r\n  };\r\n\r\n  function isBluetoothEnabled(arg) {\r\n    return new Promise(function (resolve, reject) {\r\n      try {\r\n        resolve(_isEnabled());\r\n      } catch (ex) {\r\n        console.log(\"Error in Bluetooth.isBluetoothEnabled: \" + ex);\r\n        reject(ex);\r\n      }\r\n    });\r\n  };\r\n\r\n  // Java UUID -> JS\r\n  function _uuidToString(uuid) {\r\n    var uuidStr = uuid.toString();\r\n    var pattern = java.util.regex.Pattern.compile(\"0000(.{4})-0000-1000-8000-00805f9b34fb\", 2);\r\n    var matcher = pattern.matcher(uuidStr);\r\n    return matcher.matches() ? matcher.group(1) : uuidStr;\r\n  };\r\n\r\n  // JS UUID -> Java\r\n  function _stringToUuid(uuidStr) {\r\n    if (uuidStr.length === 4) {\r\n      uuidStr = \"0000\" + uuidStr + \"-0000-1000-8000-00805f9b34fb\";\r\n    }\r\n    return java.util.UUID.fromString(uuidStr);\r\n  };\r\n\r\n  function startScanning(arg) {\r\n    return new Promise(function (resolve, reject) {\r\n      try {\r\n        if (!_isEnabled()) {\r\n          reject(\"Bluetooth is not enabled\");\r\n          return;\r\n        }\r\n        // log a warning when on Android M and no permission has been granted (it's up to the dev to implement that flow though)\r\n        if (!_coarseLocationPermissionGranted()) {\r\n          console.warn(\"Coarse location permission has not been granted; scanning for peripherals may fail.\");\r\n        }\r\n\r\n        _connections = {};\r\n\r\n        var serviceUUIDs = arg.serviceUUIDs || [];\r\n        var uuids = [];\r\n        for (var s in serviceUUIDs) {\r\n          uuids.push(_stringToUuid(serviceUUIDs[s]));\r\n        }\r\n\r\n        if (android.os.Build.VERSION.SDK_INT < 21 /*android.os.Build.VERSION_CODES.LOLLIPOP */) {\r\n          var didStart = uuids.length === 0 ?\r\n            adapter.startLeScan(_scanCallback) :\r\n            adapter.startLeScan(uuids, _scanCallback);\r\n          if (!didStart) {\r\n            // TODO error msg, see https://github.com/randdusing/cordova-plugin-bluetoothle/blob/master/src/android/BluetoothLePlugin.java#L758\r\n            reject(\"Scanning didn't start\");\r\n            return;\r\n          }\r\n        } else {\r\n          var scanFilters = null;\r\n          if (uuids.length > 0) {\r\n            scanFilters = new java.util.ArrayList();\r\n            for (var u in uuids) {\r\n              var theUuid = uuids[u];\r\n              var scanFilterBuilder = new android.bluetooth.le.ScanFilter.Builder();\r\n              scanFilterBuilder.setServiceUuid(new android.os.ParcelUuid(theUuid));\r\n              scanFilters.add(scanFilterBuilder.build());\r\n            }\r\n          }\r\n          // ga hier verder: https://github.com/randdusing/cordova-plugin-bluetoothle/blob/master/src/android/BluetoothLePlugin.java#L775\r\n          var scanSettings = new android.bluetooth.le.ScanSettings.Builder();\r\n          scanSettings.setReportDelay(0);\r\n\r\n          var scanMode = arg.scanMode || android.bluetooth.le.ScanSettings.SCAN_MODE_LOW_LATENCY;\r\n          scanSettings.setScanMode(scanMode);\r\n\r\n          if (android.os.Build.VERSION.SDK_INT >= 23 /*android.os.Build.VERSION_CODES.M */) {\r\n            var matchMode = arg.matchMode || android.bluetooth.le.ScanSettings.MATCH_MODE_AGGRESSIVE;\r\n            scanSettings.setMatchMode(matchMode);\r\n\r\n            var matchNum = arg.matchNum || android.bluetooth.le.ScanSettings.MATCH_NUM_MAX_ADVERTISEMENT;\r\n            scanSettings.setNumOfMatches(matchNum);\r\n\r\n            var callbackType = arg.callbackType || android.bluetooth.le.ScanSettings.CALLBACK_TYPE_ALL_MATCHES;\r\n            scanSettings.setCallbackType(callbackType);\r\n          }\r\n          adapter.getBluetoothLeScanner().startScan(scanFilters, scanSettings.build(), _scanCallback);\r\n        }\r\n\r\n        onDiscovered = arg.onDiscovered;\r\n\r\n        if (arg.seconds) {\r\n          setTimeout(function () {\r\n            // note that by now a manual 'stop' may have been invoked, but that doesn't hurt\r\n            if (android.os.Build.VERSION.SDK_INT < 21 /* android.os.Build.VERSION_CODES.LOLLIPOP */) {\r\n              adapter.stopLeScan(_scanCallback);\r\n            } else {\r\n              adapter.getBluetoothLeScanner().stopScan(_scanCallback);\r\n            }\r\n            resolve();\r\n          }, arg.seconds * 1000);\r\n        } else {\r\n          resolve();\r\n        }\r\n      } catch (ex) {\r\n        console.log(\"Error in Bluetooth.startScanning: \" + ex);\r\n        reject(ex);\r\n      }\r\n    });\r\n  };\r\n\r\n  function stopScanning() {\r\n    return new Promise(function (resolve, reject) {\r\n      try {\r\n        if (!_isEnabled()) {\r\n          reject(\"Bluetooth is not enabled\");\r\n          return;\r\n        }\r\n        if (android.os.Build.VERSION.SDK_INT < 21 /* android.os.Build.VERSION_CODES.LOLLIPOP */) {\r\n          adapter.stopLeScan(_scanCallback);\r\n        } else {\r\n          adapter.getBluetoothLeScanner().stopScan(_scanCallback);\r\n        }\r\n        resolve();\r\n      } catch (ex) {\r\n        console.log(\"Error in Bluetooth.stopScanning: \" + ex);\r\n        reject(ex);\r\n      }\r\n    });\r\n  };\r\n\r\n  function _disconnect(gatt) {\r\n    if (gatt !== null) {\r\n      var device = gatt.getDevice();\r\n      var stateObject = _connections[device.getAddress()];\r\n      console.log(\"----- invoking disc cb\");\r\n      if (stateObject && stateObject.onDisconnected) {\r\n        stateObject.onDisconnected({\r\n          UUID: device.getAddress(),\r\n          name: device.getName()\r\n        });\r\n      } else {\r\n        console.log(\"----- !!! no disconnect callback found\");\r\n      }\r\n      _connections[device.getAddress()] = null;\r\n      gatt.close();\r\n    }\r\n  };\r\n\r\n  // note that this doesn't make much sense without scanning first\r\n  function connect(arg) {\r\n    return new Promise(function (resolve, reject) {\r\n      try {\r\n        // or macaddress..\r\n        if (!arg.UUID) {\r\n          reject(\"No UUID was passed\");\r\n          return;\r\n        }\r\n        var bluetoothDevice = adapter.getRemoteDevice(arg.UUID);\r\n        if (bluetoothDevice === null) {\r\n          reject(\"Could not find peripheral with UUID \" + arg.UUID);\r\n        } else {\r\n          console.log(\"Connecting to peripheral with UUID: \" + arg.UUID);\r\n\r\n          var bluetoothGatt;\r\n          if (android.os.Build.VERSION.SDK_INT < 23 /*android.os.Build.VERSION_CODES.M */) {\r\n            bluetoothGatt = bluetoothDevice.connectGatt(\r\n              utils.ad.getApplicationContext(), // context\r\n              false, // autoconnect\r\n              new _MyGattCallback(/* TODO pass in onWhatever function */)\r\n            );\r\n          } else {\r\n            bluetoothGatt = bluetoothDevice.connectGatt(\r\n              utils.ad.getApplicationContext(), // context\r\n              false, // autoconnect\r\n              new _MyGattCallback(/* TODO pass in onWhatever function */),\r\n              android.bluetooth.BluetoothDevice.TRANSPORT_LE // 2\r\n            );\r\n          }\r\n\r\n          _connections[arg.UUID] = {\r\n            state: 'connecting',\r\n            onConnected: arg.onConnected,\r\n            onDisconnected: arg.onDisconnected,\r\n            device: bluetoothGatt // TODO rename device to gatt?\r\n          };\r\n        }\r\n      } catch (ex) {\r\n        console.log(\"Error in Bluetooth.connect: \" + ex);\r\n        reject(ex);\r\n      }\r\n    });\r\n  };\r\n\r\n  function disconnect(arg) {\r\n    return new Promise(function (resolve, reject) {\r\n      try {\r\n        if (!arg.UUID) {\r\n          reject(\"No UUID was passed\");\r\n          return;\r\n        }\r\n        var connection = _connections[arg.UUID];\r\n        if (!connection) {\r\n          reject(\"Peripheral wasn't connected\");\r\n          return;\r\n        }\r\n\r\n        _disconnect(connection.device);\r\n        resolve();\r\n      } catch (ex) {\r\n        console.log(\"Error in Bluetooth.disconnect: \" + ex);\r\n        reject(ex);\r\n      }\r\n    });\r\n  };\r\n\r\n  // This guards against peripherals reusing char UUID's. We prefer notify.\r\n  function _findNotifyCharacteristic(bluetoothGattService, characteristicUUID) {\r\n    // Check for Notify first\r\n    var characteristics = bluetoothGattService.getCharacteristics();\r\n    for (var i = 0; i < characteristics.size(); i++) {\r\n      var c = characteristics.get(i);\r\n      if ((c.getProperties() & android.bluetooth.BluetoothGattCharacteristic.PROPERTY_NOTIFY) !== 0 && characteristicUUID.equals(c.getUuid())) {\r\n        return c;\r\n      }\r\n    }\r\n\r\n    // If there wasn't a Notify Characteristic, check for Indicate\r\n    for (i = 0; i < characteristics.size(); i++) {\r\n      var ch = characteristics.get(i);\r\n      if ((ch.getProperties() & android.bluetooth.BluetoothGattCharacteristic.PROPERTY_INDICATE) !== 0 && characteristicUUID.equals(ch.getUuid())) {\r\n        return ch;\r\n      }\r\n    }\r\n\r\n    // As a last resort, try and find ANY characteristic with this UUID, even if it doesn't have the correct properties\r\n    return bluetoothGattService.getCharacteristic(characteristicUUID);\r\n  };\r\n\r\n  // This guards against peripherals reusing char UUID's.\r\n  function _findCharacteristicOfType(bluetoothGattService, characteristicUUID, charType) {\r\n    var characteristics = bluetoothGattService.getCharacteristics();\r\n    for (var i = 0; i < characteristics.size(); i++) {\r\n      var c = characteristics.get(i);\r\n      if ((c.getProperties() & charType) !== 0 && characteristicUUID.equals(c.getUuid())) {\r\n        return c;\r\n      }\r\n    }\r\n    // As a last resort, try and find ANY characteristic with this UUID, even if it doesn't have the correct properties\r\n    return bluetoothGattService.getCharacteristic(characteristicUUID);\r\n  };\r\n\r\n  function _getWrapper(arg, reject) {\r\n    if (!_isEnabled()) {\r\n      reject(\"Bluetooth is not enabled\");\r\n      return;\r\n    }\r\n    if (!arg.peripheralUUID) {\r\n      reject(\"No peripheralUUID was passed\");\r\n      return;\r\n    }\r\n    if (!arg.serviceUUID) {\r\n      reject(\"No serviceUUID was passed\");\r\n      return;\r\n    }\r\n    if (!arg.characteristicUUID) {\r\n      reject(\"No characteristicUUID was passed\");\r\n      return;\r\n    }\r\n\r\n    var serviceUUID = _stringToUuid(arg.serviceUUID);\r\n\r\n    var stateObject = _connections[arg.peripheralUUID];\r\n    if (!stateObject) {\r\n      reject(\"The peripheral is disconnected\");\r\n      return;\r\n    }\r\n\r\n    var gatt = stateObject.device;\r\n    var bluetoothGattService = gatt.getService(serviceUUID);\r\n\r\n    if (!bluetoothGattService) {\r\n      reject(\"Could not find service with UUID \" + arg.serviceUUID + \" on peripheral with UUID \" + arg.peripheralUUID);\r\n      return;\r\n    }\r\n\r\n    // with that all being checked, let's return a wrapper object containing all the stuff we found here\r\n    return {\r\n      gatt: gatt,\r\n      bluetoothGattService: bluetoothGattService\r\n    };\r\n  };\r\n\r\n  function read(arg) {\r\n    return new Promise(function (resolve, reject) {\r\n      try {\r\n        var wrapper = _getWrapper(arg, reject);\r\n        if (wrapper === null) {\r\n          // no need to reject, this has already been done\r\n          return;\r\n        }\r\n\r\n        var gatt = wrapper.gatt;\r\n        var bluetoothGattService = wrapper.bluetoothGattService;\r\n        var characteristicUUID = _stringToUuid(arg.characteristicUUID);\r\n\r\n        var bluetoothGattCharacteristic = _findCharacteristicOfType(bluetoothGattService, characteristicUUID, android.bluetooth.BluetoothGattCharacteristic.PROPERTY_READ);\r\n        if (!bluetoothGattCharacteristic) {\r\n          reject(\"Could not find characteristic with UUID \" + arg.characteristicUUID + \" on service with UUID \" + arg.serviceUUID + \" on peripheral with UUID \" + arg.peripheralUUID);\r\n          return;\r\n        }\r\n\r\n        var stateObject = _connections[arg.peripheralUUID];\r\n        stateObject.onReadPromise = resolve;\r\n        if (!gatt.readCharacteristic(bluetoothGattCharacteristic)) {\r\n          reject(\"Failed to set client characteristic read for \" + characteristicUUID);\r\n        }\r\n      } catch (ex) {\r\n        console.log(\"Error in Bluetooth.read: \" + ex);\r\n        reject(ex);\r\n      }\r\n    });\r\n  };\r\n\r\n  // val must be a Uint8Array or Uint16Array or a string like '0x01' or '0x007F' or '0x01,0x02', or '0x007F,'0x006F''\r\n  function _encodeValue(val) {\r\n    // if it's not a string assume it's a byte array already\r\n    if (typeof val != 'string') {\r\n      return val;\r\n    }\r\n    var parts = val.split(',');\r\n    if (parts[0].indexOf('x') == -1) {\r\n      return null;\r\n    }\r\n    var result = Array.create(\"byte\", parts.length);\r\n\r\n    for (var i = 0; i < parts.length; i++) {\r\n      result[i] = parts[i];\r\n    }\r\n    return result;\r\n  };\r\n\r\n  function write(arg) {\r\n    return new Promise(function (resolve, reject) {\r\n      try {\r\n        if (!arg.value) {\r\n          reject(\"You need to provide some data to write in the 'value' property\");\r\n          return;\r\n        }\r\n        var wrapper = _getWrapper(arg, reject);\r\n        if (wrapper === null) {\r\n          // no need to reject, this has already been done\r\n          return;\r\n        }\r\n\r\n        var bluetoothGattCharacteristic = _findCharacteristicOfType(wrapper.bluetoothGattService, _stringToUuid(arg.characteristicUUID), android.bluetooth.BluetoothGattCharacteristic.PROPERTY_WRITE);\r\n        if (!bluetoothGattCharacteristic) {\r\n          reject(\"Could not find characteristic with UUID \" + arg.characteristicUUID + \" on service with UUID \" + arg.serviceUUID + \" on peripheral with UUID \" + arg.peripheralUUID);\r\n          return;\r\n        }\r\n\r\n        var val = _encodeValue(arg.value);\r\n        if (val === null) {\r\n          reject(\"Invalid value: \" + arg.value);\r\n          return;\r\n        }\r\n\r\n        bluetoothGattCharacteristic.setValue(val);\r\n        bluetoothGattCharacteristic.setWriteType(android.bluetooth.BluetoothGattCharacteristic.WRITE_TYPE_DEFAULT);\r\n\r\n        _connections[arg.peripheralUUID].onWritePromise = resolve;\r\n        if (!wrapper.gatt.writeCharacteristic(bluetoothGattCharacteristic)) {\r\n          reject(\"Failed to write to characteristic \" + arg.characteristicUUID);\r\n        }\r\n      } catch (ex) {\r\n        console.log(\"Error in Bluetooth.write: \" + ex);\r\n        reject(ex);\r\n      }\r\n    });\r\n  };\r\n\r\n  function writeWithoutResponse(arg) {\r\n    return new Promise(function (resolve, reject) {\r\n      try {\r\n        if (!arg.value) {\r\n          reject(\"You need to provide some data to write in the 'value' property\");\r\n          return;\r\n        }\r\n        var wrapper = _getWrapper(arg, reject);\r\n        if (wrapper === null) {\r\n          // no need to reject, this has already been done\r\n          return;\r\n        }\r\n\r\n        var bluetoothGattCharacteristic = _findCharacteristicOfType(wrapper.bluetoothGattService, _stringToUuid(arg.characteristicUUID), android.bluetooth.BluetoothGattCharacteristic.PROPERTY_WRITE);\r\n        if (!bluetoothGattCharacteristic) {\r\n          reject(\"Could not find characteristic with UUID \" + arg.characteristicUUID + \" on service with UUID \" + arg.serviceUUID + \" on peripheral with UUID \" + arg.peripheralUUID);\r\n          return;\r\n        }\r\n\r\n        var val = _encodeValue(arg.value);\r\n        if (val === null) {\r\n          reject(\"Invalid value: \" + arg.value);\r\n          return;\r\n        }\r\n\r\n        bluetoothGattCharacteristic.setValue(val);\r\n        bluetoothGattCharacteristic.setWriteType(android.bluetooth.BluetoothGattCharacteristic.WRITE_TYPE_NO_RESPONSE);\r\n\r\n        if (wrapper.gatt.writeCharacteristic(bluetoothGattCharacteristic)) {\r\n          resolve();\r\n        } else {\r\n          reject(\"Failed to write to characteristic \" + arg.characteristicUUID);\r\n        }\r\n      } catch (ex) {\r\n        console.log(\"Error in Bluetooth.writeWithoutResponse: \" + ex);\r\n        reject(ex);\r\n      }\r\n    });\r\n  };\r\n\r\n  function startNotifying(arg) {\r\n    return new Promise(function (resolve, reject) {\r\n      try {\r\n        var wrapper = _getWrapper(arg, reject);\r\n        if (wrapper === null) {\r\n          // no need to reject, this has already been done\r\n          return;\r\n        }\r\n\r\n        var gatt = wrapper.gatt;\r\n        var bluetoothGattService = wrapper.bluetoothGattService;\r\n        var characteristicUUID = _stringToUuid(arg.characteristicUUID);\r\n\r\n        var bluetoothGattCharacteristic = _findNotifyCharacteristic(bluetoothGattService, characteristicUUID);\r\n        if (!bluetoothGattCharacteristic) {\r\n          reject(\"Could not find characteristic with UUID \" + arg.characteristicUUID + \" on service with UUID \" + arg.serviceUUID + \" on peripheral with UUID \" + arg.peripheralUUID);\r\n          return;\r\n        }\r\n\r\n        if (!gatt.setCharacteristicNotification(bluetoothGattCharacteristic, true)) {\r\n          reject(\"Failed to register notification for characteristic \" + arg.characteristicUUID);\r\n          return;\r\n        }\r\n\r\n        var clientCharacteristicConfigId = _stringToUuid(\"2902\");\r\n        var bluetoothGattDescriptor = bluetoothGattCharacteristic.getDescriptor(clientCharacteristicConfigId);\r\n        if (!bluetoothGattDescriptor) {\r\n          reject(\"Set notification failed for \" + characteristicUUID);\r\n          return;\r\n        }\r\n\r\n        // prefer notify over indicate\r\n        if ((bluetoothGattCharacteristic.getProperties() & android.bluetooth.BluetoothGattCharacteristic.PROPERTY_NOTIFY) !== 0) {\r\n          bluetoothGattDescriptor.setValue(android.bluetooth.BluetoothGattDescriptor.ENABLE_NOTIFICATION_VALUE);\r\n        } else if ((bluetoothGattCharacteristic.getProperties() & android.bluetooth.BluetoothGattCharacteristic.PROPERTY_INDICATE) !== 0) {\r\n          bluetoothGattDescriptor.setValue(android.bluetooth.BluetoothGattDescriptor.ENABLE_INDICATION_VALUE);\r\n        } else {\r\n          console.log(\"Characteristic \" + characteristicUUID + \" does not have NOTIFY or INDICATE property set\");\r\n        }\r\n\r\n        if (gatt.writeDescriptor(bluetoothGattDescriptor)) {\r\n          var cb = arg.onNotify || function (result) { console.log(\"No 'onNotify' callback function specified for 'startNotifying'\"); };\r\n          var stateObject = _connections[arg.peripheralUUID];\r\n          stateObject.onNotifyCallback = cb;\r\n          console.log(\"--- notifying\");\r\n          resolve();\r\n        } else {\r\n          reject(\"Failed to set client characteristic notification for \" + characteristicUUID);\r\n        }\r\n      } catch (ex) {\r\n        console.log(\"Error in Bluetooth.startNotifying: \" + ex);\r\n        reject(ex);\r\n      }\r\n    });\r\n  };\r\n\r\n  // TODO lot of reuse between this and .startNotifying\r\n  function stopNotifying(arg) {\r\n    return new Promise(function (resolve, reject) {\r\n      try {\r\n        var wrapper = _getWrapper(arg, reject);\r\n        if (wrapper === null) {\r\n          // no need to reject, this has already been done\r\n          return;\r\n        }\r\n\r\n        var gatt = wrapper.gatt;\r\n        var bluetoothGattService = wrapper.bluetoothGattService;\r\n        var characteristicUUID = _stringToUuid(arg.characteristicUUID);\r\n\r\n        var bluetoothGattCharacteristic = _findNotifyCharacteristic(bluetoothGattService, characteristicUUID);\r\n        console.log(\"---- got gatt service char: \" + bluetoothGattCharacteristic);\r\n\r\n        if (!bluetoothGattCharacteristic) {\r\n          reject(\"Could not find characteristic with UUID \" + arg.characteristicUUID + \" on service with UUID \" + arg.serviceUUID + \" on peripheral with UUID \" + arg.peripheralUUID);\r\n          return;\r\n        }\r\n\r\n        var stateObject = _connections[arg.peripheralUUID];\r\n        stateObject.onNotifyCallback = null;\r\n\r\n        if (gatt.setCharacteristicNotification(bluetoothGattCharacteristic, false)) {\r\n          resolve();\r\n        } else {\r\n          reject(\"Failed to remove client characteristic notification for \" + characteristicUUID);\r\n        }\r\n\r\n      } catch (ex) {\r\n        console.log(\"Error in Bluetooth.stopNotifying: \" + ex);\r\n        reject(ex);\r\n      }\r\n    });\r\n  };\r\n\r\n}\r\nexport = Bluetooth;"],"sourceRoot":"/source/"}