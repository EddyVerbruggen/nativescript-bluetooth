{"version":3,"sources":["bluetooth.android.ts"],"names":[],"mappings":"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","file":"bluetooth.android.js","sourcesContent":["///<reference path=\"_references.d.ts\" />\"\r\n\r\nimport * as utils from \"utils/utils\"\r\nimport * as application from \"application\";\r\nimport {bluetooth} from \"./bluetooth-common\";\r\n\r\nvar Bluetooth = bluetooth;\r\nvar ACCESS_COARSE_LOCATION_PERMISSION_REQUEST_CODE = 222;\r\n\r\nvar adapter,\r\n    onDiscovered;\r\n\r\nBluetooth._coarseLocationPermissionGranted = function () {\r\n  var hasPermission = android.os.Build.VERSION.SDK_INT < 23; // Android M. (6.0)\r\n  if (!hasPermission) {\r\n    hasPermission = android.content.pm.PackageManager.PERMISSION_GRANTED ==\r\n      android.support.v4.content.ContextCompat.checkSelfPermission(application.android.foregroundActivity, android.Manifest.permission.ACCESS_COARSE_LOCATION);\r\n  }\r\n  return hasPermission;\r\n};\r\n\r\nBluetooth.hasCoarseLocationPermission = function () {\r\n  return new Promise(function (resolve) {\r\n    resolve(Bluetooth._coarseLocationPermissionGranted());\r\n  });\r\n};\r\n\r\nBluetooth.requestCoarseLocationPermission = function () {\r\n  return new Promise(function (resolve) {\r\n    if (!Bluetooth._coarseLocationPermissionGranted()) {\r\n      // in a future version we could hook up the callback and change this flow a bit\r\n      android.support.v4.app.ActivityCompat.requestPermissions(\r\n          application.android.foregroundActivity,\r\n          [android.Manifest.permission.ACCESS_COARSE_LOCATION],\r\n          ACCESS_COARSE_LOCATION_PERMISSION_REQUEST_CODE);\r\n      // this is not the nicest solution as the user needs to initiate scanning again after granting permission,\r\n      // so enhance this in a future version, but it's ok for now\r\n      resolve();\r\n    }\r\n  });\r\n};\r\n\r\n/**\r\n * Connections are stored as key-val pairs of UUID-Connection.\r\n * So something like this:\r\n * [{\r\n *   34343-2434-5454: {\r\n *     state: 'connected',\r\n *     discoveredState: '',\r\n *     operationConnect: someCallbackFunction\r\n *   },\r\n *   1323213-21321323: {\r\n *     ..\r\n *   }\r\n * }, ..]\r\n */\r\nBluetooth._connections = {};\r\n\r\n(function () {\r\n  var bluetoothManager = utils.ad.getApplicationContext().getSystemService(android.content.Context.BLUETOOTH_SERVICE);\r\n  adapter = bluetoothManager.getAdapter();\r\n\r\n  if (android.os.Build.VERSION.SDK_INT >= 21 /*android.os.Build.VERSION_CODES.LOLLIPOP */) {\r\n    var MyScanCallback = android.bluetooth.le.ScanCallback.extend({\r\n      onBatchScanResults: function(results) {\r\n        console.log(\"------- scanCallback.onBatchScanResults\");\r\n      },\r\n      onScanFailed: function(errorCode) {\r\n        console.log(\"------- scanCallback.onScanFailed errorCode: \" + errorCode);\r\n        var errorMessage;\r\n        if (errorCode == android.bluetooth.le.ScanCallback.SCAN_FAILED_ALREADY_STARTED) {\r\n          errorMessage = \"Scan already started\";\r\n        } else if (errorCode == android.bluetooth.le.ScanCallback.SCAN_FAILED_APPLICATION_REGISTRATION_FAILED) {\r\n          errorMessage = \"Application registration failed\";\r\n        } else if (errorCode == android.bluetooth.le.ScanCallback.SCAN_FAILED_FEATURE_UNSUPPORTED) {\r\n          errorMessage = \"Feature unsupported\";\r\n        } else if (errorCode == android.bluetooth.le.ScanCallback.SCAN_FAILED_INTERNAL_ERROR) {\r\n          errorMessage = \"Internal error\";\r\n        } else {\r\n          errorMessage = \"Scan failed to start\";\r\n        }\r\n        console.log(\"------- scanCallback.onScanFailed errorMessage: \" + errorMessage);\r\n      },\r\n      onScanResult: function(callbackType, result) {\r\n        var stateObject = Bluetooth._connections[result.getDevice().getAddress()];\r\n        if (!stateObject) {\r\n          Bluetooth._connections[result.getDevice().getAddress()] = {\r\n            state: 'disconnected'\r\n          };\r\n          var payload = {\r\n            type: 'scanResult', // TODO or use different callback functions?\r\n            UUID: result.getDevice().getAddress(),\r\n            name: result.getDevice().getName(),\r\n            RSSI: result.getRssi(),\r\n            state: 'disconnected',\r\n            advertisement: android.util.Base64.encodeToString(result.getScanRecord().getBytes(), android.util.Base64.NO_WRAP)\r\n          };\r\n          console.log(\"---- Lollipop+ scanCallback result: \" + JSON.stringify(payload));\r\n          onDiscovered(payload);\r\n        }\r\n      }\r\n    });\r\n    Bluetooth._scanCallback = new MyScanCallback();\r\n  } else {\r\n    Bluetooth._scanCallback = new android.bluetooth.BluetoothAdapter.LeScanCallback({\r\n      // see https://github.com/randdusing/cordova-plugin-bluetoothle/blob/master/src/android/BluetoothLePlugin.java#L2181\r\n      onLeScan: function(device, rssi, scanRecord) {\r\n        var stateObject = Bluetooth._connections[device.getAddress()];\r\n        if (!stateObject) {\r\n          Bluetooth._connections[device.getAddress()] = {\r\n            state: 'disconnected'\r\n          };\r\n          onDiscovered({\r\n            type: 'scanResult', // TODO or use different callback functions?\r\n            UUID: device.getAddress(), // TODO consider renaming to id (and iOS as well)\r\n            name: device.getName(),\r\n            RSSI: rssi,\r\n            state: 'disconnected'\r\n          });\r\n        }\r\n      }\r\n    });\r\n  }\r\n})();\r\n\r\n// callback for connecting and read/write operations\r\nBluetooth._MyGattCallback = android.bluetooth.BluetoothGattCallback.extend({\r\n  // add constructor which gets a callback\r\n\r\n  /**\r\n   * newState (BluetoothProfile.state)\r\n   * 0: disconnected\r\n   * 1: connecting\r\n   * 2: connected\r\n   * 3: disconnecting\r\n   */\r\n  onConnectionStateChange: function(bluetoothGatt, status, newState) {\r\n    console.log(\"------- _MyGattCallback.onConnectionStateChange, status: \" + status + \", new state: \" + newState);\r\n\r\n    // https://github.com/don/cordova-plugin-ble-central/blob/master/src/android/Peripheral.java#L191    \r\n    if (newState == 2 /* connected */ && status === 0 /* gatt success */) {\r\n      console.log(\"---- discovering services..\");\r\n      bluetoothGatt.discoverServices();\r\n    } else {\r\n      // perhaps the device was manually disconnected, or in use by another device\r\n      Bluetooth._disconnect(bluetoothGatt);\r\n    }\r\n  },\r\n\r\n  onServicesDiscovered: function(bluetoothGatt, status) {\r\n    console.log(\"------- _MyGattCallback.onServicesDiscovered, status (0=success): \" + status);\r\n\r\n    if (status === 0 /* gatt success */) {\r\n      // TODO grab from cached object and extend with services data?\r\n      var services = bluetoothGatt.getServices();\r\n      var servicesJs = [];\r\n      var btChar = android.bluetooth.BluetoothGattCharacteristic;\r\n      for (var i = 0; i < services.size(); i++) {\r\n        var service = services.get(i);\r\n        var characteristics = service.getCharacteristics();\r\n        var characteristicsJs = [];\r\n        for (var j = 0; j < characteristics.size(); j++) {\r\n          var characteristic = characteristics.get(j);\r\n          var props = characteristic.getProperties();\r\n          var descriptors = characteristic.getDescriptors();\r\n          var descriptorsJs = [];\r\n          for (var k = 0; k < descriptors.size(); k++) {\r\n            var descriptor = descriptors.get(k);\r\n            var descriptorJs = {\r\n              UUID: Bluetooth._uuidToString(descriptor.getUuid()),\r\n              value: descriptor.getValue(), // always empty btw\r\n              permissions: null\r\n            };\r\n            var descPerms = descriptor.getPermissions();\r\n            if (descPerms > 0) {\r\n              descriptorJs.permissions = {\r\n                read: (descPerms & btChar.PERMISSION_READ) !== 0,\r\n                readEncrypted: (descPerms & btChar.PERMISSION_READ_ENCRYPTED) !== 0,\r\n                readEncryptedMitm: (descPerms & btChar.PERMISSION_READ_ENCRYPTED_MITM) !== 0,\r\n                write: (descPerms & btChar.PERMISSION_WRITE) !== 0,\r\n                writeEncrypted: (descPerms & btChar.PERMISSION_WRITE_ENCRYPTED) !== 0,\r\n                writeEncryptedMitm: (descPerms & btChar.PERMISSION_WRITE_ENCRYPTED_MITM) !== 0,\r\n                writeSigned: (descPerms & btChar.PERMISSION_WRITE_SIGNED) !== 0,\r\n                writeSignedMitm: (descPerms & btChar.PERMISSION_WRITE_SIGNED_MITM) !== 0\r\n              };\r\n            }\r\n            descriptorsJs.push(descriptorJs);\r\n          }\r\n\r\n          var characteristicJs = {\r\n            UUID: Bluetooth._uuidToString(characteristic.getUuid()),\r\n            name: Bluetooth._uuidToString(characteristic.getUuid()), // there's no sep field on Android\r\n            properties: {\r\n              read: (props & btChar.PROPERTY_READ) !== 0,\r\n              write: (props & btChar.PROPERTY_WRITE) !== 0,\r\n              writeWithoutResponse: (props & btChar.PROPERTY_WRITE_NO_RESPONSE) !== 0,\r\n              notify: (props & btChar.PROPERTY_NOTIFY) !== 0,\r\n              indicate: (props & btChar.PROPERTY_INDICATE) !== 0,\r\n              broadcast: (props & btChar.PROPERTY_BROADCAST) !== 0,\r\n              authenticatedSignedWrites: (props & btChar.PROPERTY_SIGNED_WRITE) !== 0,\r\n              extendedProperties: (props & btChar.PROPERTY_EXTENDED_PROPS) !== 0\r\n            },\r\n            descriptors: descriptorsJs,\r\n            permissions: null\r\n          };\r\n          // permissions are usually not provided, so let's not return them in that case\r\n          var charPerms = characteristic.getPermissions();\r\n          if (charPerms > 0) {\r\n            characteristicJs.permissions = {\r\n              read: (charPerms & btChar.PERMISSION_READ) !== 0,\r\n              readEncrypted: (charPerms & btChar.PERMISSION_READ_ENCRYPTED) !== 0,\r\n              readEncryptedMitm: (charPerms & btChar.PERMISSION_READ_ENCRYPTED_MITM) !== 0,\r\n              write: (charPerms & btChar.PERMISSION_WRITE) !== 0,\r\n              writeEncrypted: (charPerms & btChar.PERMISSION_WRITE_ENCRYPTED) !== 0,\r\n              writeEncryptedMitm: (charPerms & btChar.PERMISSION_WRITE_ENCRYPTED_MITM) !== 0,\r\n              writeSigned: (charPerms & btChar.PERMISSION_WRITE_SIGNED) !== 0,\r\n              writeSignedMitm: (charPerms & btChar.PERMISSION_WRITE_SIGNED_MITM) !== 0\r\n            };\r\n          }\r\n          characteristicsJs.push(characteristicJs);\r\n        }\r\n\r\n        servicesJs.push({\r\n          UUID: Bluetooth._uuidToString(service.getUuid()),\r\n          characteristics: characteristicsJs\r\n        });\r\n      }\r\n      var device = bluetoothGatt.getDevice();\r\n      var stateObject = Bluetooth._connections[device.getAddress()];\r\n      stateObject.onConnected({\r\n        UUID: device.getAddress(), // TODO consider renaming to id (and iOS as well)\r\n        name: device.getName(),\r\n        state: 'connected', // Bluetooth._getState(peripheral.state),\r\n        services: servicesJs\r\n      });\r\n    }\r\n  },\r\n\r\n  _decodeValue: function(value) {\r\n    if (value === null) {\r\n      return null;\r\n    }\r\n\r\n    // value is of Java type: byte[]\r\n    var b = android.util.Base64.encodeToString(value, android.util.Base64.NO_WRAP);\r\n    return Bluetooth._base64ToArrayBuffer(b);\r\n  },\r\n\r\n  onCharacteristicRead: function(bluetoothGatt, bluetoothGattCharacteristic, status) {\r\n    console.log(\"------- _MyGattCallback.onCharacteristicRead\");\r\n\r\n    var device = bluetoothGatt.getDevice();\r\n    var stateObject = Bluetooth._connections[device.getAddress()];\r\n    if (!stateObject) {\r\n      Bluetooth._disconnect(bluetoothGatt);\r\n      return;\r\n    }\r\n\r\n    if (stateObject.onReadPromise) {\r\n      var value = bluetoothGattCharacteristic.getValue();\r\n      stateObject.onReadPromise({\r\n        valueRaw: value,\r\n        value: this._decodeValue(value),\r\n        characteristicUUID: bluetoothGattCharacteristic.getUuid()\r\n      });\r\n    }\r\n  },\r\n\r\n  onCharacteristicChanged: function(bluetoothGatt, bluetoothGattCharacteristic) {\r\n    console.log(\"------- _MyGattCallback.onCharacteristicChanged\");\r\n\r\n    var device = bluetoothGatt.getDevice();\r\n    var stateObject = Bluetooth._connections[device.getAddress()];\r\n    if (!stateObject) {\r\n      Bluetooth._disconnect(bluetoothGatt);\r\n      return;\r\n    }\r\n\r\n    if (stateObject.onNotifyCallback) {\r\n      var value = bluetoothGattCharacteristic.getValue();\r\n      stateObject.onNotifyCallback({\r\n        valueRaw: value,\r\n        value: this._decodeValue(value),\r\n        characteristicUUID: bluetoothGattCharacteristic.getUuid()\r\n      });\r\n    }\r\n  },\r\n\r\n  onCharacteristicWrite: function(bluetoothGatt, bluetoothGattCharacteristic, status) {\r\n    console.log(\"------- _MyGattCallback.onCharacteristicWrite\");\r\n\r\n    var device = bluetoothGatt.getDevice();\r\n    var stateObject = Bluetooth._connections[device.getAddress()];\r\n    if (!stateObject) {\r\n      Bluetooth._disconnect(bluetoothGatt);\r\n      return;\r\n    }\r\n\r\n    console.log(bluetoothGattCharacteristic);\r\n\r\n    if (stateObject.onWritePromise) {\r\n      stateObject.onWritePromise({\r\n        characteristicUUID: bluetoothGattCharacteristic.getUuid()\r\n      });\r\n    }\r\n  },\r\n\r\n  onDescriptorRead: function(bluetoothGatt, bluetoothGattDescriptor, status) {\r\n    console.log(\"------- _MyGattCallback.onDescriptorRead\");\r\n  },\r\n\r\n  onDescriptorWrite: function(bluetoothGatt, bluetoothGattDescriptor, status) {\r\n    console.log(\"------- _MyGattCallback.onDescriptorWrite\");\r\n  },\r\n\r\n  onReadRemoteRssi: function(bluetoothGatt, rssi, status) {\r\n    console.log(\"------- _MyGattCallback.onReadRemoteRssi\");\r\n  },\r\n\r\n  onMtuChanged: function(bluetoothGatt, mtu, status) {\r\n    console.log(\"------- _MyGattCallback.onMtuChanged\");\r\n  }\r\n});\r\n\r\nBluetooth._isEnabled = function (arg) {\r\n  return adapter !== null && adapter.isEnabled();\r\n};\r\n\r\nBluetooth.isBluetoothEnabled = function (arg) {\r\n  return new Promise(function (resolve, reject) {\r\n    try {\r\n      resolve(Bluetooth._isEnabled());\r\n    } catch (ex) {\r\n      console.log(\"Error in Bluetooth.isBluetoothEnabled: \" + ex);\r\n      reject(ex);\r\n    }\r\n  });\r\n};\r\n\r\n// Java UUID -> JS\r\nBluetooth._uuidToString = function(uuid) {\r\n  var uuidStr = uuid.toString();\r\n  var pattern = java.util.regex.Pattern.compile(\"0000(.{4})-0000-1000-8000-00805f9b34fb\", 2);\r\n  var matcher = pattern.matcher(uuidStr);\r\n  return matcher.matches() ? matcher.group(1) : uuidStr;\r\n};\r\n\r\n// JS UUID -> Java\r\nBluetooth._stringToUuid = function(uuidStr) {\r\n  if (uuidStr.length === 4) {\r\n    uuidStr = \"0000\" + uuidStr + \"-0000-1000-8000-00805f9b34fb\";\r\n  }\r\n  return java.util.UUID.fromString(uuidStr);\r\n};\r\n\r\nBluetooth.startScanning = function (arg) {\r\n  return new Promise(function (resolve, reject) {\r\n    try {\r\n      if (!Bluetooth._isEnabled()) {\r\n        reject(\"Bluetooth is not enabled\");\r\n        return;\r\n      }\r\n      // log a warning when on Android M and no permission has been granted (it's up to the dev to implement that flow though)\r\n      if (!Bluetooth._coarseLocationPermissionGranted()) {\r\n        console.warn(\"Coarse location permission has not been granted; scanning for peripherals may fail.\");\r\n      }\r\n\r\n      Bluetooth._connections = {};\r\n\r\n      var serviceUUIDs = arg.serviceUUIDs || [];\r\n      var uuids = [];\r\n      for (var s in serviceUUIDs) {\r\n        uuids.push(Bluetooth._stringToUuid(serviceUUIDs[s]));\r\n      }\r\n\r\n      if (android.os.Build.VERSION.SDK_INT < 21 /*android.os.Build.VERSION_CODES.LOLLIPOP */) {\r\n        var didStart = uuids.length === 0 ?\r\n            adapter.startLeScan(Bluetooth._scanCallback) :\r\n            adapter.startLeScan(uuids, Bluetooth._scanCallback);\r\n        if (!didStart) {\r\n          // TODO error msg, see https://github.com/randdusing/cordova-plugin-bluetoothle/blob/master/src/android/BluetoothLePlugin.java#L758\r\n          reject(\"Scanning didn't start\");\r\n          return;\r\n        }\r\n      } else {\r\n        var scanFilters = null;\r\n        if (uuids.length > 0) {\r\n          scanFilters = new java.util.ArrayList();\r\n          for (var u in uuids) {\r\n            var theUuid = uuids[u];\r\n            var scanFilterBuilder = new android.bluetooth.le.ScanFilter.Builder();\r\n            scanFilterBuilder.setServiceUuid(new android.os.ParcelUuid(theUuid));\r\n            scanFilters.add(scanFilterBuilder.build());\r\n          }\r\n        }\r\n        // ga hier verder: https://github.com/randdusing/cordova-plugin-bluetoothle/blob/master/src/android/BluetoothLePlugin.java#L775\r\n        var scanSettings = new android.bluetooth.le.ScanSettings.Builder();\r\n        scanSettings.setReportDelay(0);\r\n\r\n        var scanMode = arg.scanMode || android.bluetooth.le.ScanSettings.SCAN_MODE_LOW_LATENCY;\r\n        scanSettings.setScanMode(scanMode);\r\n\r\n        if (android.os.Build.VERSION.SDK_INT >= 23 /*android.os.Build.VERSION_CODES.M */) {\r\n          var matchMode = arg.matchMode || android.bluetooth.le.ScanSettings.MATCH_MODE_AGGRESSIVE;\r\n          scanSettings.setMatchMode(matchMode);\r\n\r\n          var matchNum = arg.matchNum || android.bluetooth.le.ScanSettings.MATCH_NUM_MAX_ADVERTISEMENT;\r\n          scanSettings.setNumOfMatches(matchNum);\r\n\r\n          var callbackType = arg.callbackType || android.bluetooth.le.ScanSettings.CALLBACK_TYPE_ALL_MATCHES;\r\n          scanSettings.setCallbackType(callbackType);\r\n        }\r\n        adapter.getBluetoothLeScanner().startScan(scanFilters, scanSettings.build(), Bluetooth._scanCallback);\r\n      }\r\n\r\n      onDiscovered = arg.onDiscovered;\r\n\r\n      if (arg.seconds) {\r\n        setTimeout(function() {\r\n          // note that by now a manual 'stop' may have been invoked, but that doesn't hurt\r\n          if (android.os.Build.VERSION.SDK_INT < 21 /* android.os.Build.VERSION_CODES.LOLLIPOP */) {\r\n            adapter.stopLeScan(Bluetooth._scanCallback);\r\n          } else {\r\n            adapter.getBluetoothLeScanner().stopScan(Bluetooth._scanCallback);\r\n          }\r\n          resolve();\r\n        }, arg.seconds * 1000);\r\n      } else {\r\n        resolve();\r\n      }\r\n    } catch (ex) {\r\n      console.log(\"Error in Bluetooth.startScanning: \" + ex);\r\n      reject(ex);\r\n    }\r\n  });\r\n};\r\n\r\nBluetooth.stopScanning = function () {\r\n  return new Promise(function (resolve, reject) {\r\n    try {\r\n      if (!Bluetooth._isEnabled()) {\r\n        reject(\"Bluetooth is not enabled\");\r\n        return;\r\n      }\r\n      if (android.os.Build.VERSION.SDK_INT < 21 /* android.os.Build.VERSION_CODES.LOLLIPOP */) {\r\n        adapter.stopLeScan(Bluetooth._scanCallback);\r\n      } else {\r\n        adapter.getBluetoothLeScanner().stopScan(Bluetooth._scanCallback);\r\n      }\r\n      resolve();\r\n    } catch (ex) {\r\n      console.log(\"Error in Bluetooth.stopScanning: \" + ex);\r\n      reject(ex);\r\n    }\r\n  });\r\n};\r\n\r\nBluetooth._disconnect = function(gatt) {\r\n  if (gatt !== null) {\r\n    var device = gatt.getDevice();\r\n    var stateObject = Bluetooth._connections[device.getAddress()];\r\n    console.log(\"----- invoking disc cb\");\r\n    if (stateObject && stateObject.onDisconnected) {\r\n      stateObject.onDisconnected({\r\n        UUID: device.getAddress(),\r\n        name: device.getName()\r\n      });\r\n    } else {\r\n      console.log(\"----- !!! no disconnect callback found\");\r\n    }\r\n    Bluetooth._connections[device.getAddress()] = null;\r\n    gatt.close();\r\n  }\r\n};\r\n\r\n// note that this doesn't make much sense without scanning first\r\nBluetooth.connect = function (arg) {\r\n  return new Promise(function (resolve, reject) {\r\n    try { \r\n      // or macaddress..\r\n      if (!arg.UUID) {\r\n        reject(\"No UUID was passed\");\r\n        return;\r\n      }\r\n      var bluetoothDevice = adapter.getRemoteDevice(arg.UUID);\r\n      if (bluetoothDevice === null) {\r\n        reject(\"Could not find peripheral with UUID \" + arg.UUID);\r\n      } else {\r\n        console.log(\"Connecting to peripheral with UUID: \" + arg.UUID);\r\n\r\n        var bluetoothGatt;\r\n        if (android.os.Build.VERSION.SDK_INT < 23 /*android.os.Build.VERSION_CODES.M */) {\r\n          bluetoothGatt = bluetoothDevice.connectGatt(\r\n              utils.ad.getApplicationContext(), // context\r\n              false, // autoconnect\r\n              new Bluetooth._MyGattCallback(/* TODO pass in onWhatever function */)\r\n          );\r\n        } else {\r\n          bluetoothGatt = bluetoothDevice.connectGatt(\r\n              utils.ad.getApplicationContext(), // context\r\n              false, // autoconnect\r\n              new Bluetooth._MyGattCallback(/* TODO pass in onWhatever function */),\r\n              android.bluetooth.BluetoothDevice.TRANSPORT_LE // 2\r\n          );\r\n        }\r\n\r\n        Bluetooth._connections[arg.UUID] = {\r\n          state: 'connecting',\r\n          onConnected: arg.onConnected,\r\n          onDisconnected: arg.onDisconnected,\r\n          device: bluetoothGatt // TODO rename device to gatt?\r\n        };\r\n      }\r\n    } catch (ex) {\r\n      console.log(\"Error in Bluetooth.connect: \" + ex);\r\n      reject(ex);\r\n    }\r\n  });\r\n};\r\n\r\nBluetooth.disconnect = function (arg) {\r\n  return new Promise(function (resolve, reject) {\r\n    try {\r\n      if (!arg.UUID) {\r\n        reject(\"No UUID was passed\");\r\n        return;\r\n      }\r\n      var connection = Bluetooth._connections[arg.UUID];\r\n      if (!connection) {\r\n        reject(\"Peripheral wasn't connected\");\r\n        return;\r\n      }\r\n\r\n      Bluetooth._disconnect(connection.device);\r\n      resolve();\r\n    } catch (ex) {\r\n      console.log(\"Error in Bluetooth.disconnect: \" + ex);\r\n      reject(ex);\r\n    }\r\n  });\r\n};\r\n\r\n// This guards against peripherals reusing char UUID's. We prefer notify.\r\nBluetooth._findNotifyCharacteristic = function(bluetoothGattService, characteristicUUID) {\r\n  // Check for Notify first\r\n  var characteristics = bluetoothGattService.getCharacteristics();\r\n  for (var i = 0; i < characteristics.size(); i++) {\r\n    var c = characteristics.get(i);\r\n    if ((c.getProperties() & android.bluetooth.BluetoothGattCharacteristic.PROPERTY_NOTIFY) !== 0 && characteristicUUID.equals(c.getUuid())) {\r\n      return c;\r\n    }\r\n  }\r\n\r\n  // If there wasn't a Notify Characteristic, check for Indicate\r\n  for (i = 0; i < characteristics.size(); i++) {\r\n    var ch = characteristics.get(i);\r\n    if ((ch.getProperties() & android.bluetooth.BluetoothGattCharacteristic.PROPERTY_INDICATE) !== 0 && characteristicUUID.equals(ch.getUuid())) {\r\n      return ch;\r\n    }\r\n  }\r\n\r\n  // As a last resort, try and find ANY characteristic with this UUID, even if it doesn't have the correct properties\r\n  return bluetoothGattService.getCharacteristic(characteristicUUID);\r\n};\r\n\r\n// This guards against peripherals reusing char UUID's.\r\nBluetooth._findCharacteristicOfType = function(bluetoothGattService, characteristicUUID, charType) {\r\n  var characteristics = bluetoothGattService.getCharacteristics();\r\n  for (var i = 0; i < characteristics.size(); i++) {\r\n    var c = characteristics.get(i);\r\n    if ((c.getProperties() & charType) !== 0 && characteristicUUID.equals(c.getUuid())) {\r\n      return c;\r\n    }\r\n  }\r\n  // As a last resort, try and find ANY characteristic with this UUID, even if it doesn't have the correct properties\r\n  return bluetoothGattService.getCharacteristic(characteristicUUID);\r\n};\r\n\r\nBluetooth._getWrapper = function (arg, reject) {\r\n  if (!Bluetooth._isEnabled()) {\r\n    reject(\"Bluetooth is not enabled\");\r\n    return;\r\n  }\r\n  if (!arg.peripheralUUID) {\r\n    reject(\"No peripheralUUID was passed\");\r\n    return;\r\n  }\r\n  if (!arg.serviceUUID) {\r\n    reject(\"No serviceUUID was passed\");\r\n    return;\r\n  }\r\n  if (!arg.characteristicUUID) {\r\n    reject(\"No characteristicUUID was passed\");\r\n    return;\r\n  }\r\n\r\n  var serviceUUID = Bluetooth._stringToUuid(arg.serviceUUID);\r\n\r\n  var stateObject = Bluetooth._connections[arg.peripheralUUID];\r\n  if (!stateObject) {\r\n    reject(\"The peripheral is disconnected\");\r\n    return;\r\n  }\r\n\r\n  var gatt = stateObject.device;\r\n  var bluetoothGattService = gatt.getService(serviceUUID);\r\n\r\n  if (!bluetoothGattService) {\r\n    reject(\"Could not find service with UUID \" + arg.serviceUUID + \" on peripheral with UUID \" + arg.peripheralUUID);\r\n    return;\r\n  }\r\n\r\n  // with that all being checked, let's return a wrapper object containing all the stuff we found here\r\n  return {\r\n    gatt: gatt,\r\n    bluetoothGattService: bluetoothGattService\r\n  };\r\n};\r\n\r\nBluetooth.read = function (arg) {\r\n  return new Promise(function (resolve, reject) {\r\n    try {\r\n      var wrapper = Bluetooth._getWrapper(arg, reject);\r\n      if (wrapper === null) {\r\n        // no need to reject, this has already been done\r\n        return;\r\n      }\r\n\r\n      var gatt = wrapper.gatt;\r\n      var bluetoothGattService = wrapper.bluetoothGattService;\r\n      var characteristicUUID = Bluetooth._stringToUuid(arg.characteristicUUID);\r\n\r\n      var bluetoothGattCharacteristic = Bluetooth._findCharacteristicOfType(bluetoothGattService, characteristicUUID, android.bluetooth.BluetoothGattCharacteristic.PROPERTY_READ);\r\n      if (!bluetoothGattCharacteristic) {\r\n        reject(\"Could not find characteristic with UUID \" + arg.characteristicUUID + \" on service with UUID \" + arg.serviceUUID + \" on peripheral with UUID \" + arg.peripheralUUID);\r\n        return;\r\n      }\r\n\r\n      var stateObject = Bluetooth._connections[arg.peripheralUUID];\r\n      stateObject.onReadPromise = resolve;\r\n      if (!gatt.readCharacteristic(bluetoothGattCharacteristic)) {\r\n        reject(\"Failed to set client characteristic read for \" + characteristicUUID);\r\n      }\r\n    } catch (ex) {\r\n      console.log(\"Error in Bluetooth.read: \" + ex);\r\n      reject(ex);\r\n    }\r\n  });\r\n};\r\n\r\n// val must be a Uint8Array or Uint16Array or a string like '0x01' or '0x007F' or '0x01,0x02', or '0x007F,'0x006F''\r\nBluetooth._encodeValue = function(val) {\r\n  // if it's not a string assume it's a byte array already\r\n  if (typeof val != 'string') {\r\n    return val;\r\n  }\r\n  var parts = val.split(',');\r\n  if (parts[0].indexOf('x') == -1) {\r\n    return null;\r\n  }\r\n  var result = Array.create(\"byte\", parts.length);\r\n\r\n  for (var i=0; i<parts.length; i++) {\r\n    result[i] = parts[i];\r\n  }\r\n  return result;\r\n};\r\n\r\nBluetooth.write = function (arg) {\r\n  return new Promise(function (resolve, reject) {\r\n    try {\r\n      if (!arg.value) {\r\n        reject(\"You need to provide some data to write in the 'value' property\");\r\n        return;\r\n      }\r\n      var wrapper = Bluetooth._getWrapper(arg, reject);\r\n      if (wrapper === null) {\r\n        // no need to reject, this has already been done\r\n        return;\r\n      }\r\n\r\n      var bluetoothGattCharacteristic = Bluetooth._findCharacteristicOfType(wrapper.bluetoothGattService, Bluetooth._stringToUuid(arg.characteristicUUID), android.bluetooth.BluetoothGattCharacteristic.PROPERTY_WRITE);\r\n      if (!bluetoothGattCharacteristic) {\r\n        reject(\"Could not find characteristic with UUID \" + arg.characteristicUUID + \" on service with UUID \" + arg.serviceUUID + \" on peripheral with UUID \" + arg.peripheralUUID);\r\n        return;\r\n      }\r\n\r\n      var val = Bluetooth._encodeValue(arg.value);\r\n      if (val === null) {\r\n        reject(\"Invalid value: \" + arg.value);\r\n        return;\r\n      }\r\n\r\n      bluetoothGattCharacteristic.setValue(val);\r\n      bluetoothGattCharacteristic.setWriteType(android.bluetooth.BluetoothGattCharacteristic.WRITE_TYPE_DEFAULT);\r\n\r\n      Bluetooth._connections[arg.peripheralUUID].onWritePromise = resolve;\r\n      if (!wrapper.gatt.writeCharacteristic(bluetoothGattCharacteristic)) {\r\n        reject(\"Failed to write to characteristic \" + arg.characteristicUUID);\r\n      }\r\n    } catch (ex) {\r\n      console.log(\"Error in Bluetooth.write: \" + ex);\r\n      reject(ex);\r\n    }\r\n  });\r\n};\r\n\r\nBluetooth.writeWithoutResponse = function (arg) {\r\n  return new Promise(function (resolve, reject) {\r\n    try {\r\n      if (!arg.value) {\r\n        reject(\"You need to provide some data to write in the 'value' property\");\r\n        return;\r\n      }\r\n      var wrapper = Bluetooth._getWrapper(arg, reject);\r\n      if (wrapper === null) {\r\n        // no need to reject, this has already been done\r\n        return;\r\n      }\r\n\r\n      var bluetoothGattCharacteristic = Bluetooth._findCharacteristicOfType(wrapper.bluetoothGattService, Bluetooth._stringToUuid(arg.characteristicUUID), android.bluetooth.BluetoothGattCharacteristic.PROPERTY_WRITE);\r\n      if (!bluetoothGattCharacteristic) {\r\n        reject(\"Could not find characteristic with UUID \" + arg.characteristicUUID + \" on service with UUID \" + arg.serviceUUID + \" on peripheral with UUID \" + arg.peripheralUUID);\r\n        return;\r\n      }\r\n\r\n      var val = Bluetooth._encodeValue(arg.value);\r\n      if (val === null) {\r\n        reject(\"Invalid value: \" + arg.value);\r\n        return;\r\n      }\r\n\r\n      bluetoothGattCharacteristic.setValue(val);\r\n      bluetoothGattCharacteristic.setWriteType(android.bluetooth.BluetoothGattCharacteristic.WRITE_TYPE_NO_RESPONSE);\r\n\r\n      if (wrapper.gatt.writeCharacteristic(bluetoothGattCharacteristic)) {\r\n        resolve();\r\n      } else {\r\n        reject(\"Failed to write to characteristic \" + arg.characteristicUUID);\r\n      }\r\n    } catch (ex) {\r\n      console.log(\"Error in Bluetooth.writeWithoutResponse: \" + ex);\r\n      reject(ex);\r\n    }\r\n  });\r\n};\r\n\r\nBluetooth.startNotifying = function (arg) {\r\n  return new Promise(function (resolve, reject) {\r\n    try {\r\n      var wrapper = Bluetooth._getWrapper(arg, reject);\r\n      if (wrapper === null) {\r\n        // no need to reject, this has already been done\r\n        return;\r\n      }\r\n\r\n      var gatt = wrapper.gatt;\r\n      var bluetoothGattService = wrapper.bluetoothGattService;\r\n      var characteristicUUID = Bluetooth._stringToUuid(arg.characteristicUUID);\r\n\r\n      var bluetoothGattCharacteristic = Bluetooth._findNotifyCharacteristic(bluetoothGattService, characteristicUUID);\r\n      if (!bluetoothGattCharacteristic) {\r\n        reject(\"Could not find characteristic with UUID \" + arg.characteristicUUID + \" on service with UUID \" + arg.serviceUUID + \" on peripheral with UUID \" + arg.peripheralUUID);\r\n        return;\r\n      }\r\n\r\n      if (!gatt.setCharacteristicNotification(bluetoothGattCharacteristic, true)) {\r\n        reject(\"Failed to register notification for characteristic \" + arg.characteristicUUID);\r\n        return;\r\n      }\r\n\r\n      var clientCharacteristicConfigId = Bluetooth._stringToUuid(\"2902\");\r\n      var bluetoothGattDescriptor = bluetoothGattCharacteristic.getDescriptor(clientCharacteristicConfigId);\r\n      if (!bluetoothGattDescriptor) {\r\n        reject(\"Set notification failed for \" + characteristicUUID);\r\n        return;\r\n      }\r\n\r\n      // prefer notify over indicate\r\n      if ((bluetoothGattCharacteristic.getProperties() & android.bluetooth.BluetoothGattCharacteristic.PROPERTY_NOTIFY) !== 0) {\r\n        bluetoothGattDescriptor.setValue(android.bluetooth.BluetoothGattDescriptor.ENABLE_NOTIFICATION_VALUE);\r\n      } else if ((bluetoothGattCharacteristic.getProperties() & android.bluetooth.BluetoothGattCharacteristic.PROPERTY_INDICATE) !== 0) {\r\n        bluetoothGattDescriptor.setValue(android.bluetooth.BluetoothGattDescriptor.ENABLE_INDICATION_VALUE);\r\n      } else {\r\n        console.log(\"Characteristic \" + characteristicUUID + \" does not have NOTIFY or INDICATE property set\");\r\n      }\r\n\r\n      if (gatt.writeDescriptor(bluetoothGattDescriptor)) {\r\n        var cb = arg.onNotify || function(result) { console.log(\"No 'onNotify' callback function specified for 'startNotifying'\"); };\r\n        var stateObject = Bluetooth._connections[arg.peripheralUUID];\r\n        stateObject.onNotifyCallback = cb;\r\n        console.log(\"--- notifying\");\r\n        resolve();\r\n      } else {\r\n        reject(\"Failed to set client characteristic notification for \" + characteristicUUID);\r\n      }\r\n    } catch (ex) {\r\n      console.log(\"Error in Bluetooth.startNotifying: \" + ex);\r\n      reject(ex);\r\n    }\r\n  });\r\n};\r\n\r\n// TODO lot of reuse between this and .startNotifying\r\nBluetooth.stopNotifying = function (arg) {\r\n  return new Promise(function (resolve, reject) {\r\n    try {\r\n      var wrapper = Bluetooth._getWrapper(arg, reject);\r\n      if (wrapper === null) {\r\n        // no need to reject, this has already been done\r\n        return;\r\n      }\r\n\r\n      var gatt = wrapper.gatt;\r\n      var bluetoothGattService = wrapper.bluetoothGattService;\r\n      var characteristicUUID = Bluetooth._stringToUuid(arg.characteristicUUID);\r\n\r\n      var bluetoothGattCharacteristic = Bluetooth._findNotifyCharacteristic(bluetoothGattService, characteristicUUID);\r\n      console.log(\"---- got gatt service char: \" + bluetoothGattCharacteristic);\r\n\r\n      if (!bluetoothGattCharacteristic) {\r\n        reject(\"Could not find characteristic with UUID \" + arg.characteristicUUID + \" on service with UUID \" + arg.serviceUUID + \" on peripheral with UUID \" + arg.peripheralUUID);\r\n        return;\r\n      }\r\n\r\n      var stateObject = Bluetooth._connections[arg.peripheralUUID];\r\n      stateObject.onNotifyCallback = null;\r\n\r\n      if (gatt.setCharacteristicNotification(bluetoothGattCharacteristic, false)) {\r\n        resolve();\r\n      } else {\r\n        reject(\"Failed to remove client characteristic notification for \" + characteristicUUID);\r\n      }\r\n\r\n    } catch (ex) {\r\n      console.log(\"Error in Bluetooth.stopNotifying: \" + ex);\r\n      reject(ex);\r\n    }\r\n  });\r\n};\r\n\r\nmodule.exports = Bluetooth;"],"sourceRoot":"/source/"}