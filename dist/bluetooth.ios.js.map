{"version":3,"sources":["bluetooth.ios.ts"],"names":[],"mappings":"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","file":"bluetooth.ios.js","sourcesContent":["/// <reference path=\"_references.d.ts\" />\r\nimport {common} from \"./bluetooth-common\";\r\n\r\nmodule Bluetooth {\r\n\r\n  var _state = {\r\n    manager: null,\r\n    centralDelegate: null,\r\n    peripheralArray: null,\r\n    connectCallbacks: {},\r\n    disconnectCallbacks: {},\r\n    onDiscovered: null\r\n  };\r\n\r\n  var Common = new common;\r\n\r\n  class CBPeripheralDelegateImpl {\r\n    _callback: any;\r\n    _servicesWithCharacteristics: Array<any>;\r\n    _services: Array<any>;\r\n\r\n    initWithCallback(callback) {\r\n      this._callback = callback;\r\n      // this._services = [];\r\n      this._servicesWithCharacteristics = [];\r\n      return this;\r\n    };\r\n\r\n    peripheralDidDiscoverServices(peripheral, error) {\r\n      console.log(\"----- delegate peripheralDidDiscoverServices\");\r\n\r\n      // map native services to a JS object\r\n      this._services = [];\r\n      for (var i = 0; i < peripheral.services.count; i++) {\r\n        var service = peripheral.services.objectAtIndex(i);\r\n        this._services.push({\r\n          UUID: service.UUID.UUIDString,\r\n          name: service.UUID\r\n        });\r\n        // NOTE: discover all is slow\r\n        peripheral.discoverCharacteristicsForService(null, service);\r\n      }\r\n    };\r\n    peripheralDidDiscoverIncludedServicesForServiceError(peripheral, service, error) {\r\n      console.log(\"----- delegate peripheral:didDiscoverIncludedServicesForService:error\");\r\n    };\r\n    _getProperties(characteristic) {\r\n      var props = characteristic.properties;\r\n      return {\r\n        broadcast: (props & CBCharacteristicPropertyBroadcast) == CBCharacteristicPropertyBroadcast,\r\n        read: (props & CBCharacteristicPropertyRead) == CBCharacteristicPropertyRead,\r\n        broadcast2: (props & CBCharacteristicPropertyBroadcast) == CBCharacteristicPropertyBroadcast,\r\n        read2: (props & CBCharacteristicPropertyRead) == CBCharacteristicPropertyRead,\r\n        write: (props & CBCharacteristicPropertyWrite) == CBCharacteristicPropertyWrite,\r\n        writeWithoutResponse: (props & CBCharacteristicPropertyWriteWithoutResponse) == CBCharacteristicPropertyWriteWithoutResponse,\r\n        notify: (props & CBCharacteristicPropertyNotify) == CBCharacteristicPropertyNotify,\r\n        indicate: (props & CBCharacteristicPropertyIndicate) == CBCharacteristicPropertyIndicate,\r\n        authenticatedSignedWrites: (props & CBCharacteristicPropertyAuthenticatedSignedWrites) == CBCharacteristicPropertyAuthenticatedSignedWrites,\r\n        extendedProperties: (props & CBCharacteristicPropertyExtendedProperties) == CBCharacteristicPropertyExtendedProperties,\r\n        notifyEncryptionRequired: (props & CBCharacteristicPropertyNotifyEncryptionRequired) == CBCharacteristicPropertyNotifyEncryptionRequired,\r\n        indicateEncryptionRequired: (props & CBCharacteristicPropertyIndicateEncryptionRequired) == CBCharacteristicPropertyIndicateEncryptionRequired\r\n      };\r\n    };\r\n    _getDescriptors(characteristic) {\r\n      var descs = characteristic.descriptors;\r\n      var descsJs = [];\r\n      for (var i = 0; i < descs.count; i++) {\r\n        var desc = descs.objectAtIndex(i);\r\n        console.log(\"--------- descriptor value: \" + desc.value);\r\n        descsJs.push({\r\n          UUID: desc.UUID.UUIDString,\r\n          value: desc.value\r\n        });\r\n      }\r\n      return descsJs;\r\n    };\r\n\r\n    peripheralDidDiscoverCharacteristicsForServiceError(peripheral, service, error) {\r\n      if (error) {\r\n        // TODO invoke reject and stop processing\r\n        return;\r\n      }\r\n      var characteristics = [];\r\n      for (var i = 0; i < service.characteristics.count; i++) {\r\n        var characteristic = service.characteristics.objectAtIndex(i);\r\n        var result = {\r\n          UUID: characteristic.UUID.UUIDString,\r\n          name: characteristic.UUID,\r\n          // see serviceAndCharacteristicInfo in CBPer+Ext of Cordova plugin\r\n          value: characteristic.value ? characteristic.value.base64EncodedStringWithOptions(0) : null,\r\n          properties: this._getProperties(characteristic),\r\n          // descriptors: this._getDescriptors(characteristic), // TODO we're not currently discovering these\r\n          isNotifying: characteristic.isNotifying,\r\n          permissions: characteristic.permissions // prolly not too useful\r\n        };\r\n        characteristics.push(result);\r\n\r\n        for (var j = 0; j < this._services.length; j++) {\r\n          var s = this._services[j];\r\n          if (s.UUID == service.UUID.UUIDString) {\r\n            s.characteristics = characteristics;\r\n            this._servicesWithCharacteristics.push(s);\r\n            // the same service may be found multiple times, so make sure it's not added yet\r\n            this._services.splice(j, 1);\r\n            break;\r\n          }\r\n        }\r\n\r\n        // Could add this one day: get details about the characteristic\r\n        // peripheral.discoverDescriptorsForCharacteristic(characteristic);\r\n      }\r\n\r\n      if (this._services.length === 0) {\r\n        if (this._callback) {\r\n          this._callback({\r\n            UUID: peripheral.identifier.UUIDString,\r\n            name: peripheral.name,\r\n            state: _getState(peripheral.state),\r\n            services: this._servicesWithCharacteristics\r\n          });\r\n          this._callback = null;\r\n        }\r\n      }\r\n    };\r\n\r\n    _toArrayBuffer(value) {\r\n      if (value === null) {\r\n        return null;\r\n      }\r\n\r\n      // value is of ObjC type: NSData\r\n      var b = value.base64EncodedStringWithOptions(0);\r\n      return Common._base64ToArrayBuffer(b);\r\n    };\r\n\r\n    // this is called when a value is read from a peripheral\r\n    peripheralDidUpdateValueForCharacteristicError(peripheral, characteristic, error) {\r\n      if (!characteristic) {\r\n        console.log(\"^^^^^^^^ NO peripheralDidUpdateValueForCharacteristicError\");\r\n        return;\r\n      }\r\n\r\n      if (error !== null) {\r\n        // TODO handle.. pass in sep callback?\r\n        console.log(\"------------ error @ peripheralDidUpdateValueForCharacteristicError!\");\r\n        return;\r\n      }\r\n\r\n      var result = {\r\n        type: characteristic.isNotifying ? \"notification\" : \"read\",\r\n        characteristicUUID: characteristic.UUID.UUIDString,\r\n        valueRaw: characteristic.value,\r\n        value: this._toArrayBuffer(characteristic.value)\r\n      };\r\n\r\n      if (result.type === \"read\") {\r\n        if (_onReadPromise) {\r\n          _onReadPromise(result);\r\n        } else {\r\n          console.log(\"No _onReadPromise found!\");\r\n        }\r\n      } else {\r\n        if (_onNotifyCallback) {\r\n          _onNotifyCallback(result);\r\n        } else {\r\n          console.log(\"^^^^^^^^ CALLBACK IS GONE!\");\r\n        }\r\n      }\r\n    };\r\n    peripheralDidWriteValueForCharacteristicError(peripheral, characteristic, error) {\r\n      console.log(\"----- delegate peripheral:didWriteValueForCharacteristic:error\");\r\n      if (_onWritePromise) {\r\n        _onWritePromise({\r\n          characteristicUUID: characteristic.UUID.UUIDString\r\n        });\r\n      } else {\r\n        console.log(\"No _onWritePromise found!\");\r\n      }\r\n    };\r\n\r\n    // The peripheral letting us know whether our subscribe/unsubscribe happened or not\r\n    peripheralDidUpdateNotificationStateForCharacteristicError(peripheral, characteristic, error) {\r\n      console.log(\"----- delegate peripheral:didUpdateNotificationStateForCharacteristic:error, error: \" + error);\r\n      // alert(\"peripheralDidUpdateNotificationStateForCharacteristicError\");\r\n      if (error) {\r\n        console.log(\"----- delegate peripheral:didUpdateNotificationStateForCharacteristic:error.localizedDescription, \" + error.localizedDescription);\r\n      } else {\r\n        if (characteristic.isNotifying) {\r\n          console.log(\"------ Notification began on \" + characteristic);\r\n        } else {\r\n          console.log(\"------ Notification stopped on \" + characteristic + \", consider diconnecting\");\r\n          // _state.manager.cancelPeripheralConnection(peripheral);\r\n        }\r\n      }\r\n    };\r\n    peripheralDidDiscoverDescriptorsForCharacteristicError(peripheral, characteristic, error) {\r\n\r\n      // NOTE that this cb won't be invoked bc we curr don't discover descriptors\r\n\r\n      console.log(\"----- delegate peripheral:didDiscoverDescriptorsForCharacteristic:error\");\r\n      console.log(\"----- delegate peripheral:didDiscoverDescriptorsForCharacteristic:error characteristic.value: \" + characteristic.value);\r\n\r\n      // TODO extract details, see https://github.com/randdusing/cordova-plugin-bluetoothle/blob/master/src/ios/BluetoothLePlugin.m#L1844\r\n      console.log(characteristic.descriptors);\r\n      for (var i = 0; i < characteristic.descriptors.count; i++) {\r\n        var descriptor = characteristic.descriptors.objectAtIndex(i);\r\n        console.log(\"char desc UUID: \" + descriptor.UUID.UUIDString);\r\n      }\r\n\r\n      // now let's see if we're ready to invoke the callback\r\n      // TODO wait for the last one, THEN return\r\n      if (this._services.length == this._servicesWithCharacteristics.length) {\r\n        if (this._callback) {\r\n          this._callback({\r\n            UUID: peripheral.identifier.UUIDString,\r\n            name: peripheral.name,\r\n            state: _getState(peripheral.state),\r\n            services: this._services\r\n          });\r\n          this._callback = null;\r\n        }\r\n      }\r\n    };\r\n    peripheralDidUpdateValueForDescriptorError(peripheral, descriptor, error) {\r\n      console.log(\"----- delegate peripheral:didUpdateValueForDescriptor:error\");\r\n    };\r\n    peripheralDidWriteValueForDescriptorError(peripheral, descriptor, error) {\r\n      console.log(\"----- delegate peripheral:didWriteValueForDescriptor:error\");\r\n    };\r\n  }\r\n  //CBPeripheralDelegateImpl.ObjCProtocols = [CBPeripheralDelegate];\r\n  //return CBPeripheralDelegateImpl;\r\n  //}//)(NSObject);\r\n\r\n  class CBCentralManagerDelegateImpl {\r\n    _callback;\r\n    initWithCallback(callback) {\r\n      this._callback = callback;\r\n      return this;\r\n    };\r\n    // fires when a peripheral is discovered after executing the 'scan' function\r\n    centralManagerDidDiscoverPeripheralAdvertisementDataRSSI(central, peripheral, advData, RSSI) {\r\n      console.log(\"----- delegate centralManager:didDiscoverPeripheral: \" + peripheral.name + \" @ \" + RSSI);\r\n      var peri = _findPeripheral(peripheral.identifier.UUIDString);\r\n      if (!peri) {\r\n        _state.peripheralArray.addObject(peripheral);\r\n        if (_state.onDiscovered) {\r\n          _state.onDiscovered({\r\n            UUID: peripheral.identifier.UUIDString,\r\n            name: peripheral.name,\r\n            RSSI: RSSI,\r\n            state: _getState(peripheral.state)\r\n          });\r\n        } else {\r\n          console.log(\"----- !!! No onDiscovered callback specified\");\r\n        }\r\n      }\r\n    };\r\n    centralManagerDidUpdateState(central) {\r\n      console.log(\"----- delegate centralManagerDidUpdateState: \" + central.state);\r\n      if (central.state == CBCentralManagerStateUnsupported) {\r\n        console.log(\"WARNING: This hardware does not support Bluetooth Low Energy.\");\r\n      }\r\n    };\r\n    centralManagerWillRestoreState(central, dict) {\r\n      console.log(\"----- delegate centralManager:willRestoreState\");\r\n    };\r\n    centralManagerDidConnectPeripheral(central, peripheral) {\r\n      console.log(\"----- delegate centralManager:didConnectPeripheral: \" + peripheral);\r\n\r\n      // find the peri in the array and attach the delegate to that\r\n      var peri = _findPeripheral(peripheral.identifier.UUIDString);\r\n      console.log(\"----- delegate centralManager:didConnectPeripheral: cached perio: \" + peri);\r\n\r\n      var cb = _state.connectCallbacks[peripheral.identifier.UUIDString];\r\n      var delegate = this.initWithCallback(cb);\r\n      CFRetain(delegate);\r\n      peri.delegate = delegate;\r\n\r\n      console.log(\"----- delegate centralManager:didConnectPeripheral, let's discover service\");\r\n      peri.discoverServices(null);\r\n    };\r\n    centralManagerDidDisconnectPeripheralError(central, peripheral, error) {\r\n      // this event needs to be honored by the client as any action afterwards crashes the app\r\n      var cb = _state.disconnectCallbacks[peripheral.identifier.UUIDString];\r\n      if (cb) {\r\n        cb({\r\n          UUID: peripheral.identifier.UUIDString,\r\n          name: peripheral.name\r\n        });\r\n      } else {\r\n        console.log(\"----- !!! no disconnect callback found\");\r\n      }\r\n      var foundAt = _state.peripheralArray.indexOfObject(peripheral);\r\n      _state.peripheralArray.removeObject(foundAt);\r\n    };\r\n    centralManagerDidFailToConnectPeripheralError(central, peripheral, error) {\r\n      // TODO send event to JS\r\n      console.log(\"----- delegate centralManager:didFailToConnectPeripheral:error\");\r\n      // this._callback(error);\r\n    };\r\n    ObjCProtocols = [CBCentralManagerDelegate];\r\n  }//)(NSObject);\r\n\r\n  // check for bluetooth being enabled as soon as the app starts\r\n  (function () {\r\n    var _CBCentralManagerDelegateImpl = new CBCentralManagerDelegateImpl;\r\n    _state.centralDelegate = _CBCentralManagerDelegateImpl.initWithCallback(function (obj) {\r\n      console.log(\"----- centralDelegate obj: \" + obj);\r\n    });\r\n    // TODO options? https://github.com/randdusing/cordova-plugin-bluetoothle/blob/master/src/ios/BluetoothLePlugin.m#L187\r\n    _state.manager = CBCentralManager.alloc().initWithDelegateQueue(_state.centralDelegate, null);\r\n  })();\r\n\r\n  function _isEnabled(arg?) {\r\n    return _state.manager.state == CBCentralManagerStatePoweredOn;\r\n  };\r\n\r\n  function _getState(stateId) {\r\n    if (stateId == CBPeripheralStateConnecting) {\r\n      return 'connecting';\r\n    } else if (stateId == CBPeripheralStateConnected) {\r\n      return 'connected';\r\n    } else if (stateId == CBPeripheralStateDisconnected) {\r\n      return 'disconnected';\r\n    } else {\r\n      console.log(\"Unexpected state, returning 'disconnected': \" + stateId);\r\n      return 'disconnected';\r\n    }\r\n  };\r\n\r\n  function isBluetoothEnabled(arg) {\r\n    return new Promise(function (resolve, reject) {\r\n      try {\r\n        resolve(_isEnabled());\r\n      } catch (ex) {\r\n        console.log(\"Error in Bluetooth.isBluetoothEnabled: \" + ex);\r\n        reject(ex);\r\n      }\r\n    });\r\n  };\r\n\r\n  function startScanning(arg) {\r\n    return new Promise(function (resolve, reject) {\r\n      try {\r\n        if (!_isEnabled()) {\r\n          reject(\"Bluetooth is not enabled\");\r\n          return;\r\n        }\r\n        _state.peripheralArray = NSMutableArray.new();\r\n\r\n        // TODO actualy, should init the delegate here with this as the callback (see 'onConnected') --> but first test if that works\r\n        _state.onDiscovered = arg.onDiscovered;\r\n        var serviceUUIDs = arg.serviceUUIDs || [];\r\n\r\n        var services = [];\r\n        for (var s in serviceUUIDs) {\r\n          services.push(CBUUID.UUIDWithString(serviceUUIDs[s]));\r\n        }\r\n        _state.manager.scanForPeripheralsWithServicesOptions(services, null);\r\n        if (arg.seconds) {\r\n          setTimeout(function () {\r\n            // note that by now a manual 'stop' may have been invoked, but that doesn't hurt\r\n            _state.manager.stopScan();\r\n            resolve();\r\n          }, arg.seconds * 1000);\r\n        } else {\r\n          resolve();\r\n        }\r\n      } catch (ex) {\r\n        console.log(\"Error in Bluetooth.startScanning: \" + ex);\r\n        reject(ex);\r\n      }\r\n    });\r\n  };\r\n\r\n  function stopScanning(arg) {\r\n    return new Promise(function (resolve, reject) {\r\n      try {\r\n        if (!_isEnabled()) {\r\n          reject(\"Bluetooth is not enabled\");\r\n          return;\r\n        }\r\n        _state.manager.stopScan();\r\n        resolve();\r\n      } catch (ex) {\r\n        console.log(\"Error in Bluetooth.stopScanning: \" + ex);\r\n        reject(ex);\r\n      }\r\n    });\r\n  };\r\n\r\n  function _findPeripheral(UUID) {\r\n    for (var i = 0; i < _state.peripheralArray.count; i++) {\r\n      var peripheral = _state.peripheralArray.objectAtIndex(i);\r\n      if (UUID == peripheral.identifier.UUIDString) {\r\n        return peripheral;\r\n      }\r\n    }\r\n    return null;\r\n  };\r\n\r\n  // note that this doesn't make much sense without scanning first\r\n  function connect(arg) {\r\n    return new Promise(function (resolve, reject) {\r\n      try {\r\n        if (!_isEnabled()) {\r\n          reject(\"Bluetooth is not enabled\");\r\n          return;\r\n        }\r\n        if (!arg.UUID) {\r\n          reject(\"No UUID was passed\");\r\n          return;\r\n        }\r\n        var peripheral = _findPeripheral(arg.UUID);\r\n        if (peripheral === null) {\r\n          reject(\"Could not find peripheral with UUID \" + arg.UUID);\r\n        } else {\r\n          console.log(\"Connecting to peripheral with UUID: \" + arg.UUID);\r\n          _state.connectCallbacks[arg.UUID] = arg.onConnected;\r\n          _state.disconnectCallbacks[arg.UUID] = arg.onDisconnected;\r\n          _state.manager.connectPeripheralOptions(peripheral, null);\r\n          resolve();\r\n        }\r\n      } catch (ex) {\r\n        console.log(\"Error in Bluetooth.connect: \" + ex);\r\n        reject(ex);\r\n      }\r\n    });\r\n  };\r\n\r\n  function disconnect(arg) {\r\n    return new Promise(function (resolve, reject) {\r\n      try {\r\n        if (!_isEnabled()) {\r\n          reject(\"Bluetooth is not enabled\");\r\n          return;\r\n        }\r\n        if (!arg.UUID) {\r\n          reject(\"No UUID was passed\");\r\n          return;\r\n        }\r\n        var peripheral = _findPeripheral(arg.UUID);\r\n        if (peripheral === null) {\r\n          reject(\"Could not find peripheral with UUID \" + arg.UUID);\r\n        } else {\r\n          console.log(\"Disconnecting peripheral with UUID: \" + arg.UUID);\r\n          // no need to send an error when already disconnected, but it's wise to check it\r\n          if (peripheral.state != CBPeripheralStateDisconnected) {\r\n            _state.manager.cancelPeripheralConnection(peripheral);\r\n            peripheral.delegate = null;\r\n            // TODO remove from the peripheralArray as well\r\n          }\r\n          resolve();\r\n        }\r\n      } catch (ex) {\r\n        console.log(\"Error in Bluetooth.disconnect: \" + ex);\r\n        reject(ex);\r\n      }\r\n    });\r\n  };\r\n\r\n  function isConnected(arg) {\r\n    return new Promise(function (resolve, reject) {\r\n      try {\r\n        if (!_isEnabled()) {\r\n          reject(\"Bluetooth is not enabled\");\r\n          return;\r\n        }\r\n        if (!arg.UUID) {\r\n          reject(\"No UUID was passed\");\r\n          return;\r\n        }\r\n        var peripheral = _findPeripheral(arg.UUID);\r\n        if (peripheral === null) {\r\n          reject(\"Could not find peripheral with UUID \" + arg.UUID);\r\n        } else {\r\n          console.log(\"checking connection with peripheral UUID: \" + arg.UUID);\r\n          resolve(peripheral.state == CBPeripheralStateConnected);\r\n        }\r\n      } catch (ex) {\r\n        console.log(\"Error in Bluetooth.isConnected: \" + ex);\r\n        reject(ex);\r\n      }\r\n    });\r\n  };\r\n\r\n  function _findService(UUID, peripheral) {\r\n    for (var i = 0; i < peripheral.services.count; i++) {\r\n      var service = peripheral.services.objectAtIndex(i);\r\n      // console.log(\"--- service.UUID: \" + service.UUID);\r\n      // TODO this may need a different compare, see Cordova plugin's findServiceFromUUID function\r\n      if (UUID.UUIDString == service.UUID.UUIDString) {\r\n        // console.log(\"--- found our service with UUID: \" + service.UUID);\r\n        return service;\r\n      }\r\n    }\r\n    // service not found on this peripheral\r\n    return null;\r\n  };\r\n\r\n  function _findCharacteristic(UUID, service, property?) {\r\n    // console.log(\"--- _findCharacteristic UUID: \" + UUID);\r\n    // console.log(\"--- _findCharacteristic service: \" + service);\r\n    console.log(\"--- _findCharacteristic characteristics: \" + service.characteristics);\r\n    // console.log(\"--- _findCharacteristic characteristics.count: \" + service.characteristics.count);\r\n    for (var i = 0; i < service.characteristics.count; i++) {\r\n      var characteristic = service.characteristics.objectAtIndex(i);\r\n      // console.log(\"--- characteristic.UUID: \" + characteristic.UUID);\r\n      if (UUID.UUIDString == characteristic.UUID.UUIDString) {\r\n        if (property) {\r\n          if ((characteristic.properties & property) == property) {\r\n            // console.log(\"--- characteristic.found: \" + characteristic.UUID);\r\n            return characteristic;\r\n          }\r\n        } else {\r\n          return characteristic;\r\n        }\r\n      }\r\n    }\r\n    // characteristic not found on this service\r\n    console.log(\"--- characteristic.NOT.found!\");\r\n    return null;\r\n  };\r\n\r\n  function _getWrapper(arg, property, reject) {\r\n    if (!_isEnabled()) {\r\n      reject(\"Bluetooth is not enabled\");\r\n      return;\r\n    }\r\n    if (!arg.peripheralUUID) {\r\n      reject(\"No peripheralUUID was passed\");\r\n      return null;\r\n    }\r\n    if (!arg.serviceUUID) {\r\n      reject(\"No serviceUUID was passed\");\r\n      return null;\r\n    }\r\n    if (!arg.characteristicUUID) {\r\n      reject(\"No characteristicUUID was passed\");\r\n      return null;\r\n    }\r\n\r\n    var peripheral = _findPeripheral(arg.peripheralUUID);\r\n    if (!peripheral) {\r\n      reject(\"Could not find peripheral with UUID \" + arg.peripheralUUID);\r\n      return null;\r\n    }\r\n\r\n    if (peripheral.state != CBPeripheralStateConnected) {\r\n      reject(\"The peripheral is disconnected\");\r\n      return null;\r\n    }\r\n\r\n    var serviceUUID = CBUUID.UUIDWithString(arg.serviceUUID);\r\n    var service = _findService(serviceUUID, peripheral);\r\n    if (!service) {\r\n      reject(\"Could not find service with UUID \" + arg.serviceUUID + \" on peripheral with UUID \" + arg.peripheralUUID);\r\n      return null;\r\n    }\r\n\r\n    var characteristicUUID = CBUUID.UUIDWithString(arg.characteristicUUID);\r\n    var characteristic = _findCharacteristic(characteristicUUID, service, property);\r\n\r\n    // Special handling for INDICATE. If charateristic with notify is not found, check for indicate.\r\n    if (property == CBCharacteristicPropertyNotify && !characteristic) {\r\n      characteristic = _findCharacteristic(characteristicUUID, service, CBCharacteristicPropertyIndicate);\r\n    }\r\n\r\n    // As a last resort, try and find ANY characteristic with this UUID, even if it doesn't have the correct properties\r\n    if (!characteristic) {\r\n      characteristic = _findCharacteristic(characteristicUUID, service);\r\n    }\r\n\r\n    if (!characteristic) {\r\n      reject(\"Could not find characteristic with UUID \" + arg.characteristicUUID + \" on service with UUID \" + arg.serviceUUID + \" on peripheral with UUID \" + arg.peripheralUUID);\r\n      return null;\r\n    }\r\n\r\n    // with that all being checked, let's return a wrapper object containing all the stuff we found here\r\n    return {\r\n      peripheral: peripheral,\r\n      service: service,\r\n      characteristic: characteristic\r\n    };\r\n  };\r\n\r\n  function read(arg) {\r\n    return new Promise(function (resolve, reject) {\r\n      try {\r\n        var wrapper = _getWrapper(arg, CBCharacteristicPropertyRead, reject);\r\n        if (wrapper === null) {\r\n          // no need to reject, this has already been done\r\n          return;\r\n        }\r\n\r\n        // TODO we could (should?) make this characteristic-specific\r\n        wrapper.peripheral.delegate._onReadPromise = resolve;\r\n        wrapper.peripheral.readValueForCharacteristic(wrapper.characteristic);\r\n      } catch (ex) {\r\n        console.log(\"Error in Bluetooth.read: \" + ex);\r\n        reject(ex);\r\n      }\r\n    });\r\n  };\r\n\r\n  function startNotifying(arg) {\r\n    return new Promise(function (resolve, reject) {\r\n      try {\r\n        var wrapper = _getWrapper(arg, CBCharacteristicPropertyNotify, reject);\r\n        console.log(\"--------- startNotifying wrapper: \" + wrapper);\r\n\r\n        if (wrapper === null) {\r\n          // no need to reject, this has already been done\r\n          return;\r\n        }\r\n        var cb = arg.onNotify || function (result) { console.log(\"No 'onNotify' callback function specified for 'startNotifying'\"); };\r\n\r\n        // TODO we could (should?) make this characteristic-specific\r\n        wrapper.peripheral.delegate._onNotifyCallback = cb;\r\n        wrapper.peripheral.setNotifyValueForCharacteristic(true, wrapper.characteristic);\r\n        resolve();\r\n      } catch (ex) {\r\n        console.log(\"Error in Bluetooth.startNotifying: \" + ex);\r\n        reject(ex);\r\n      }\r\n    });\r\n  };\r\n\r\n  function stopNotifying(arg) {\r\n    return new Promise(function (resolve, reject) {\r\n      try {\r\n        var wrapper = _getWrapper(arg, CBCharacteristicPropertyNotify, reject);\r\n        console.log(\"--------- stopNotifying wrapper: \" + wrapper);\r\n\r\n        if (wrapper === null) {\r\n          // no need to reject, this has already been done\r\n          return;\r\n        }\r\n\r\n        var peripheral = _findPeripheral(arg.peripheralUUID);\r\n        // peripheral.delegate = null;\r\n        peripheral.setNotifyValueForCharacteristic(false, wrapper.characteristic);\r\n        resolve();\r\n      } catch (ex) {\r\n        console.log(\"Error in Bluetooth.stopNotifying: \" + ex);\r\n        reject(ex);\r\n      }\r\n    });\r\n  };\r\n\r\n  // val must be a Uint8Array or Uint16Array or a string like '0x01' or '0x007F' or '0x01,0x02', or '0x007F,'0x006F''\r\n  function _encodeValue(val) {\r\n    // if it's not a string assume it's a UintXArray\r\n    if (typeof val != 'string') {\r\n      return val.buffer;\r\n    }\r\n    var parts = val.split(',');\r\n    if (parts[0].indexOf('x') == -1) {\r\n      return null;\r\n    }\r\n    var result;\r\n    if (parts[0].length == 4) { // eg. 0x01\r\n      result = new Uint8Array(parts.length);\r\n    } else {\r\n      // assuming eg. 0x007F\r\n      result = new Uint16Array(parts.length);\r\n    }\r\n    for (var i = 0; i < parts.length; i++) {\r\n      result[i] = parts[i];\r\n    }\r\n    return result.buffer;\r\n  };\r\n\r\n  function write(arg) {\r\n    return new Promise(function (resolve, reject) {\r\n      try {\r\n        if (!arg.value) {\r\n          reject(\"You need to provide some data to write in the 'value' property\");\r\n          return;\r\n        }\r\n        var wrapper = _getWrapper(arg, CBCharacteristicPropertyWrite, reject);\r\n        if (wrapper === null) {\r\n          // no need to reject, this has already been done\r\n          return;\r\n        }\r\n\r\n        var valueEncoded = _encodeValue(arg.value);\r\n        if (valueEncoded === null) {\r\n          reject(\"Invalid value: \" + arg.value);\r\n          return;\r\n        }\r\n\r\n        // the promise will be resolved from 'didWriteValueForCharacteristic',\r\n        // but we should make this characteristic-specific (see .read)\r\n        wrapper.peripheral.delegate._onWritePromise = resolve;\r\n\r\n        wrapper.peripheral.writeValueForCharacteristicType(\r\n          valueEncoded,\r\n          wrapper.characteristic,\r\n          CBCharacteristicWriteWithResponse);\r\n\r\n      } catch (ex) {\r\n        console.log(\"Error in Bluetooth.write: \" + ex);\r\n        reject(ex);\r\n      }\r\n    });\r\n  };\r\n\r\n  function writeWithoutResponse(arg) {\r\n    return new Promise(function (resolve, reject) {\r\n      try {\r\n        if (!arg.value) {\r\n          reject(\"You need to provide some data to write in the 'value' property\");\r\n          return;\r\n        }\r\n        var wrapper = _getWrapper(arg, CBCharacteristicPropertyWriteWithoutResponse, reject);\r\n        if (wrapper === null) {\r\n          // no need to reject, this has already been done\r\n          return;\r\n        }\r\n\r\n        var valueEncoded = _encodeValue(arg.value);\r\n        console.log(\"Attempting to write (encoded): \" + valueEncoded);\r\n\r\n        wrapper.peripheral.writeValueForCharacteristicType(\r\n          valueEncoded,\r\n          wrapper.characteristic,\r\n          CBCharacteristicWriteWithoutResponse);\r\n\r\n        resolve();\r\n      } catch (ex) {\r\n        console.log(\"Error in Bluetooth.writeWithoutResponse: \" + ex);\r\n        reject(ex);\r\n      }\r\n    });\r\n  };\r\n}\r\nexport = Bluetooth;"],"sourceRoot":"/source/"}